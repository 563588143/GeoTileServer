webpackJsonp([9],{"2VhM":function(t,e,i){"use strict";var s=i("lP4K"),a={BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",COMPOSITE:"cmpt",POINT_CLOUD:"pnts",VECTOR:"vctr",GEOMETRY:"geom",GLTF:"gltf",GLTF_BINARY:"glb",IMPLICIT_SUBTREE:"subt",EXTERNAL_TILESET:"externalTileset",MULTIPLE_CONTENT:"multipleContent",isBinaryFormat:function(t){switch(t){case a.BATCHED_3D_MODEL:case a.INSTANCED_3D_MODEL:case a.COMPOSITE:case a.POINT_CLOUD:case a.VECTOR:case a.GEOMETRY:case a.IMPLICIT_SUBTREE:case a.GLTF_BINARY:return!0;default:return!1}}},n=a,l={SPHERE:"sphere",BOX:"box",REGION:"region"},r={REPLACE:"REPLACE",ADD:"ADD"},o=i("RuWt"),c={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},u={createOsgb:function(t){var e=t.name,i=t.path,a=t.enu,c=t.crs,u=t.origin_offset,h=t.compress,p=t.textureFormat,d={source:{path:i,enu:a,crs:c,origin_offset:u,type:s.b.OSGB},tile:{draco:{compress:h},texture:{format:p}},output:{content_type:n.BATCHED_3D_MODEL,bounding_volume:l.SPHERE,refine:r.REPLACE}};return{name:e,type:o.F.TYPE_2,detail:d}},createTYMX:function(t){var e=t.name,i=t.path,a=t.type,u=t.enu,h=t.crs,p=t.originOffset,d=void 0===p?{x:0,y:0,z:0}:p,f=t.compress,v=t.textureFormat,m=t.fields,g=void 0===m?[]:m,_=t.isAbsoluteHeight,C=void 0!==_&&_,y=t.topHeight,b=void 0===y?null:y,x=t.baseHeight,S=void 0===x?null:x,w=t.outline,D=void 0!==w&&w,O=t.simplify,E=void 0===O?0:O,k=t.buffer,T=void 0===k?0:k,F=t.encode,z=void 0===F?o.d:F,R=t.alphaMode,L=void 0===R?c.OPAQUE:R,I=t.alphaCutoff,P=void 0===I?.5:I,B=t.doubleSided,N=void 0!==B&&B,$=t.layerName,A={source:{path:i,layer_name:void 0===$?"":$,type:a,enu:u,crs:h,origin_offset:d,fields:g,is_absolute_height:C,top_height:b?{is_fixed:b.isFixed,field:b.field||"",factor:b.factor||1,value:b.value||10}:null,base_height:S?{is_fixed:S.isFixed,field:S.field||"",factor:S.factor||1,value:S.value||0}:null,outline:D,simplify:E,buffer:T,encode:z,alpha_mode:L,alpha_cutoff:P,double_sided:N},tile:{draco:{compress:f},texture:{format:v}},output:{content_type:n.BATCHED_3D_MODEL,bounding_volume:a===s.b.SHP?l.REGION:l.SPHERE,refine:r.REPLACE}};return{name:e,type:o.F.TYPE_1,detail:A}}};e.a=u},"3U1C":function(t,e){},"4O6x":function(t,e){},"6tbM":function(t,e,i){"use strict";var s=i("deIM"),a=(i("tIHl"),i("uoUy")),n=i("T452"),l={components:{Dialog:s.a},data:function(){return{title:"倾斜摄影切片详情",path:"",visible:!1,compress:!1,hasMetaData:!1,file:null,name:"",enu:"",crs:null,originOffset:{x:0,y:0,z:0},formatLabel:"",serviceUrl:""}},computed:{originOffsetLabel:function(){var t=this.originOffset||{},e=t.x,i=void 0===e?0:e,s=t.y,a=void 0===s?0:s,n=t.z;return[i,a,void 0===n?0:n].join()},spaceLabel:function(){return this.enu?"ENU:"+this.enu.lat+","+this.enu.lng:this.crs?""+this.crs.code:""}},methods:{clear:function(){this.path="",this.visible=!1,this.compress=!1,this.name="",this.enu="",this.crs=null,this.originOffset={x:0,y:0,z:0},this.formatLabel="",this.serviceUrl=""},show:function(t){var e=this;this.clear();var i={id:t,success:function(i){var s=i||{},l=s.name,r=void 0===l?null:l,o=s.detail,c=void 0===o?{}:o,u=c.tile,h=void 0===u?{}:u,p=c.source,d=void 0===p?{}:p;e.name=r,e.enu=d.enu,e.crs=d.crs,e.originOffset=d.origin_offset||{x:0,y:0,z:0},e.path=d.path;var f=h.draco,v=void 0===f?{}:f,m=h.texture,g=void 0===m?{}:m,_=v.compress,C=void 0!==_&&_,y=g.format,b=void 0===y?a.a.DEFAULT:y;e.compress=C,e.formatLabel=Object(a.c)(b),e.serviceUrl=Object(n.c)(t,!0,!0)}};this.$http.getTileset3DByID(i),this.visible=!0},handleClose:function(){this.clear()}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Dialog",{attrs:{isShowBottomBtn:!1,title:t.title,visible:t.visible,showStep:!1,styles:{top:"20vh",width:"500px"}},on:{cus_cancel:t.handleClose}},[i("Row",{staticClass:"row-item t-s-d-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"4"}},[i("span",[t._v("名称")])]),t._v(" "),i("Col",{attrs:{span:"20"}},[i("span",[t._v(t._s(t.name))])])],1),t._v(" "),i("Row",{staticClass:"row-item t-s-d-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"4"}},[i("span",[t._v("路径")])]),t._v(" "),i("Col",{attrs:{span:"20"}},[i("span",[t._v(t._s(t.path))])])],1),t._v(" "),i("Row",{staticClass:"row-item t-s-d-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"4"}},[i("span",[t._v("空间参考")])]),t._v(" "),i("Col",{attrs:{span:"20"}},[i("span",[t._v(t._s(t.spaceLabel))])])],1),t._v(" "),i("Row",{staticClass:"row-item t-s-d-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"4"}},[i("span",[t._v("零点坐标")])]),t._v(" "),i("Col",{attrs:{span:"20"}},[i("span",[t._v(t._s(t.originOffsetLabel))])])],1),t._v(" "),i("Row",{staticClass:"row-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"4"}},[i("span",[t._v("顶点压缩")])]),t._v(" "),i("Col",{staticStyle:{"text-align":"left"},attrs:{span:"20"}},[i("Checkbox",{attrs:{disabled:""},model:{value:t.compress,callback:function(e){t.compress=e},expression:"compress"}})],1)],1),t._v(" "),i("Row",{staticClass:"row-item t-s-d-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"4"}},[i("span",[t._v("纹理格式")])]),t._v(" "),i("Col",{attrs:{span:"20"}},[i("span",[t._v(t._s(t.formatLabel))])])],1),t._v(" "),i("Row",{staticClass:"row-item t-s-d-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"4"}},[i("span",[t._v("访问地址")])]),t._v(" "),i("Col",{attrs:{span:"20"}},[i("span",[t._v(t._s(t.serviceUrl))])])],1)],1)},staticRenderFns:[]};var o=i("C7Lr")(l,r,!1,function(t){i("ObZ3")},"data-v-6f86911e",null);e.a=o.exports},"7sWg":function(t,e,i){"use strict";var s=i("deIM"),a=i("tIHl"),n=i("oFuF"),l={components:{Dialog:s.a},data:function(){return{visible:!1,x:0,y:0,z:0}},methods:{clear:function(){this.x=0,this.y=0,this.z=0},handleClose:function(){this.clear(),this.visible=!1},handleOk:function(){return n.a.isNumber(this.x)?n.a.isNumber(this.y)?n.a.isNumber(this.z)?(this.$emit("on-set",{x:this.x,y:this.y,z:this.z}),this.visible=!1,void this.clear()):(Object(a.a)("Z坐标不是数字!"),!1):(Object(a.a)("Y坐标不是数字!"),!1):(Object(a.a)("X坐标不是数字!"),!1)},show:function(t){this.clear();var e=t=t||{x:0,y:0,z:0};this.x=e.x,this.y=e.y,this.z=e.z,this.visible=!0}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Dialog",{attrs:{isShowBottomBtn:!1,title:"设置零点坐标",visible:t.visible,showStep:!1,styles:{top:"20vh",width:"400px"}},on:{cus_cancel:t.handleClose}},[i("Row",{staticClass:"row-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"4"}},[i("span",[t._v("X坐标")])]),t._v(" "),i("Col",{attrs:{span:"20"}},[i("Input",{attrs:{placeholder:"请输入数字"},model:{value:t.x,callback:function(e){t.x=t._n(e)},expression:"x"}})],1)],1),t._v(" "),i("Row",{staticClass:"row-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"4"}},[i("span",[t._v("Y坐标")])]),t._v(" "),i("Col",{attrs:{span:"20"}},[i("Input",{attrs:{placeholder:"请输入数字"},model:{value:t.y,callback:function(e){t.y=t._n(e)},expression:"y"}})],1)],1),t._v(" "),i("Row",{staticClass:"row-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"4"}},[i("span",[t._v("Z坐标")])]),t._v(" "),i("Col",{attrs:{span:"20"}},[i("Input",{attrs:{placeholder:"请输入数字"},model:{value:t.z,callback:function(e){t.z=t._n(e)},expression:"z"}})],1)],1),t._v(" "),i("Row",{staticStyle:{"margin-top":"10px"},attrs:{type:"flex",justify:"end"}},[i("Col",{staticStyle:{"text-align":"right"},attrs:{span:"24"}},[i("Button",{staticStyle:{"margin-right":"20px",width:"60px"},on:{click:function(e){return e.stopPropagation(),t.handleClose.apply(null,arguments)}}},[t._v("取消")]),t._v(" "),i("Button",{staticStyle:{width:"60px"},attrs:{type:"primary"},on:{click:function(e){return e.stopPropagation(),t.handleOk.apply(null,arguments)}}},[t._v("确定")])],1)],1)],1)},staticRenderFns:[]};var o=i("C7Lr")(l,r,!1,function(t){i("VYST")},"data-v-2b8cec33",null);e.a=o.exports},DgzN:function(t,e){},ObZ3:function(t,e){},"SpM+":function(t,e){},VYST:function(t,e){},XQUd:function(t,e,i){"use strict";var s=i("4YfN"),a=i.n(s),n=i("deIM"),l=i("tIHl"),r=i("mqoy"),o=i("oFuF"),c={components:{Dialog:n.a,SrsDialog:r.a},data:function(){return{visible:!1,isENU:!0,enu:null,crs:null,lng:null,lat:null,code:null}},methods:{clear:function(){this.isENU=!0,this.enu=null,this.crs=null,this.lng=null,this.lat=null,this.code=null},handleClose:function(){this.clear(),this.visible=!1},handleOk:function(){if(this.isENU){if(!o.a.isNumber(this.lng)||this.lng>180||this.lng<-180)return Object(l.a)("经度不合法!"),!1;if(!o.a.isNumber(this.lat)||this.lat>90||this.lat<-90)return Object(l.a)("纬度不合法!"),!1;this.$emit("on-set",{enu:{lng:this.lng,lat:this.lat},crs:null}),this.visible=!1,this.clear()}else{if(!this.crs)return Object(l.a)("请选择坐标系!"),!1;this.$emit("on-set",{crs:a()({},this.crs),enu:null}),this.visible=!1,this.clear()}},show:function(t){this.clear();var e=t||{},i=e.enu,s=void 0===i?null:i,n=e.crs,l=void 0===n?null:n;s?(this.enu=a()({},s),this.isENU=!0,this.lng=this.enu.lng,this.lat=this.enu.lat):this.isENU=!1,l&&(this.crs=a()({},l),this.code=this.crs.code),this.enu||this.crs||(this.isENU=!0),this.visible=!0},handleSrsSelect:function(t){var e=t.auth_name+":"+t.srid;this.crs=a()({},t,{code:e}),this.isENU=!1,this.code=e},showSrsDialog:function(){this.$refs.srsDialog.show()}}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Dialog",{attrs:{isShowBottomBtn:!1,title:"设置空间参考",visible:t.visible,showStep:!1,styles:{top:"20vh",width:"450px"}},on:{cus_cancel:t.handleClose}},[i("Row",{staticClass:"row-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"6"}},[i("span",[t._v("站心坐标系")])]),t._v(" "),i("Col",{attrs:{span:"18"}},[i("Checkbox",{model:{value:t.isENU,callback:function(e){t.isENU=e},expression:"isENU"}})],1)],1),t._v(" "),t.isENU?i("div",[i("Row",{staticClass:"row-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"6"}},[i("span",[t._v("经度")])]),t._v(" "),i("Col",{attrs:{span:"18"}},[i("Input",{attrs:{placeholder:"请输入经度,范围180到-180"},model:{value:t.lng,callback:function(e){t.lng=t._n(e)},expression:"lng"}})],1)],1),t._v(" "),i("Row",{staticClass:"row-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"6"}},[i("span",[t._v("纬度")])]),t._v(" "),i("Col",{attrs:{span:"18"}},[i("Input",{attrs:{placeholder:"请输入纬度,范围90到-90"},model:{value:t.lat,callback:function(e){t.lat=t._n(e)},expression:"lat"}})],1)],1)],1):i("div",[i("Row",{staticClass:"row-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"6"}},[i("span",[t._v("坐标系")])]),t._v(" "),i("Col",{attrs:{span:"18"}},[i("Row",{attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"21"}},[i("Input",{attrs:{disabled:"",placeholder:"请选择坐标系"},model:{value:t.code,callback:function(e){t.code=e},expression:"code"}})],1),t._v(" "),i("Col",{staticStyle:{"text-align":"right"},attrs:{span:"3"}},[i("span",{staticClass:"content-text-default span-split",on:{click:t.showSrsDialog}},[t._v("选择")])])],1)],1)],1)],1),t._v(" "),i("Row",{staticStyle:{"margin-top":"10px"},attrs:{type:"flex",justify:"end"}},[i("Col",{staticStyle:{"text-align":"right"},attrs:{span:"24"}},[i("Button",{staticStyle:{"margin-right":"20px",width:"60px"},on:{click:function(e){return e.stopPropagation(),t.handleClose.apply(null,arguments)}}},[t._v("取消")]),t._v(" "),i("Button",{staticStyle:{width:"60px"},attrs:{type:"primary"},on:{click:function(e){return e.stopPropagation(),t.handleOk.apply(null,arguments)}}},[t._v("确定")])],1)],1),t._v(" "),i("SrsDialog",{ref:"srsDialog",on:{"on-select":t.handleSrsSelect}})],1)},staticRenderFns:[]};var h=i("C7Lr")(c,u,!1,function(t){i("vIFc")},"data-v-593c3d88",null);e.a=h.exports},brHk:function(t,e,i){"use strict";var s=i("4YfN"),a=i.n(s),n=i("deIM"),l=i("T452"),r=i("Izdj");window.CESIUM_BASE_URL="./static/lib/Cesium";var o=window.Cesium,c=i("bSIt"),u={components:{Dialog:n.a},mixins:[r.a],data:function(){return{tableHeight:0,visible:!1,bSwitchMap:!0,viewer:null,title:"三维切片预览",id:null}},computed:a()({},Object(c.b)(["access_token"])),watch:{totalHeight:function(t){this.tableHeight=t>0?t-113:0,this.viewer&&this.viewer.resize()}},methods:{clear:function(){this.id=null},handleClose:function(){this.clear(),this.tableHeight=0,this.viewer&&this.viewer.destroy(),this.viewer=null,this.offResize&&this.offResize(),this.visible=!1,this.$emit("comp-close")},show:function(t){var e=this;this.clear(),this.onResize&&this.onResize(),this.id=t;var i={id:t,success:function(t){var i=(t||{}).name,s=void 0===i?null:i;e.name=s,e.title=s?"【"+s+"】三维切片预览":"三维切片预览",e.addTile3dLayer()}};this.$http.getTileset3DByID(i),this.visible=!0},addTile3dLayer:function(){var t=this;this.viewer=new o.Viewer("cesiumContainer"),new o.Cesium3DTileset({url:Object(l.c)(this.id,!0)}).readyPromise.then(function(e){t.viewer.scene.primitives.add(e),t.viewer.zoomTo(e,new o.HeadingPitchRange(0,-.5,2*e.boundingSphere.radius))}).otherwise(function(t){console.log(t)})}}},h={render:function(){var t=this.$createElement,e=this._self._c||t;return e("Dialog",{staticClass:"cus-view",attrs:{isShowBottomBtn:!1,fullscreen:!0,title:this.title,visible:this.visible,showStep:!1},on:{cus_cancel:this.handleClose}},[e("div",{staticClass:"v-t-d-containter"},[e("div",{style:{zIndex:this.bSwitchMap?10:0},attrs:{id:"cesiumContainer"}})])])},staticRenderFns:[]};var p=i("C7Lr")(u,h,!1,function(t){i("unTm")},"data-v-31037e9f",null);e.a=p.exports},fsLt:function(t,e,i){"use strict";var s=i("deIM"),a=i("tIHl"),n=i("RuWt"),l={props:{action:{type:String,default:n.a.ADD}},data:function(){return{accept:"application/x-zip-compressed",format:["zip"],file:null,maxSize:10,showUpload:!0,percent:0,memo:"说明：需要把Data目录或平级metadata.xml元文件压缩成zip文件",ACTION:n.a,tmpFiles:null}},computed:{size:function(){return this.maxSize+"G"},limitSize:function(){return this.maxSize*n.v}},methods:{handleBeforeUpload:function(t){return this.file=null,/\.(zip)$/.test(t.name)?t.size>this.maxSize*n.u?(Object(a.a)(this.$t("message.fileSize10GError")),this.$refs.upload.clearFiles(),!1):(this.file=t,this.uploadFile(),!1):(Object(a.a)(this.$t("message.fileFormatError")),this.$refs.upload.clearFiles(),!1)},clearProgress:function(){this.progress=0},clear:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.percent=0,this.file=null,this.showUpload=!0,t&&(this.tmpFiles=null)},uploadFile:function(){var t=this;if(!this.file)return Object(a.a)(this.$t("message.fileNullError")),!1;if(!/\.(zip)$/.test(this.file.name))return Object(a.a)(this.$t("message.fileFormatError")),!1;var e=new FormData;e.append("files",this.file);var i={data:e,params:{tileset_type:n.F.TYPE_2},uploadProgress:function(e){t.percent=e.loaded/e.total*100|0},success:function(e){if(!e||0==e.length)return Object(a.b)("没有倾斜摄影模型数据."),t.showUpload=!0,t.clearProgress(),!1;t.action===n.a.EDIT?t.tmpFiles=e:t.tmpFiles=null,t.goNext(e)},error:function(e){e?Object(a.a)(e):Object(a.a)("未知错误"),t.showUpload=!0,t.clearProgress()}};this.showUpload=!1,this.clearProgress(),this.$http.updateModelFile(i)},goNext:function(t){this.$emit("next",{step:1,files:t,action:this.action}),this.showUpload=!0,this.clearProgress(),this.file=null}}},r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showUpload,expression:"showUpload"}],staticClass:"upload_layout"},[i("span",{staticStyle:{color:"#707482","font-size":"14px","margin-bottom":"10px"}},[t._v("选择要上传的文件")]),t._v(" "),i("Upload",{ref:"upload",staticStyle:{width:"100%",padding:"0 20px"},attrs:{accept:t.accept,format:t.format,type:"drag","max-size":t.limitSize,action:"","before-upload":t.handleBeforeUpload}},[i("div",{staticClass:"upload-sub-layout"},[i("p",{staticStyle:{color:"#10243C","font-size":"12px",display:"flex","flex-direction":"row","align-items":"center"}},[i("i",{staticClass:"iconfont iconshangchuan-1 i-upload"}),t._v("\n          将文件拖至此处 或\n          "),i("span",{staticStyle:{color:"#44AAF6","margin-left":"5px"}},[t._v("点击上传")]),t._v("，文件大小不能超过"+t._s(t.size)+"\n        ")])])]),t._v(" "),t.action==t.ACTION.ADD?i("span",{staticStyle:{color:"red","font-size":"12px","margin-top":"5px"}},[t._v(t._s(t.memo))]):i("div",{staticClass:"f-s-qx-bottom"},[i("span",{staticStyle:{color:"red","font-size":"12px","margin-top":"5px"}},[t._v(t._s(t.memo))]),t._v(" "),i("Button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:function(e){return t.goNext(t.tmpFiles)}}},[t._v("下 一 步")])],1)],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.showUpload,expression:"!showUpload"}],staticClass:"upload_layout"},[i("Progress",{attrs:{"stroke-width":20,percent:t.percent}})],1)])},staticRenderFns:[]};var o=i("C7Lr")(l,r,!1,function(t){i("3U1C")},"data-v-7fbe132a",null).exports,c=i("4YfN"),u=i.n(c),h=i("2VhM"),p=i("7sWg"),d=i("XQUd"),f=i("uoUy"),v=i("lP4K"),m=i("E4LH"),g={components:{OriginOffsetDialog:p.a,KJCKDialog:d.a},data:function(){return{compress:!1,hasMetaData:!1,file:null,name:"",enu:"",crs:null,originOffset:{x:0,y:0,z:0},textureFormat:f.a.DEFAULT,textureArr:f.b,action:n.a.ADD,ACTIONS:n.a,id:null}},computed:{path:function(){return this.file?this.file.path:""},originOffsetLabel:function(){var t=this.originOffset||{},e=t.x,i=void 0===e?0:e,s=t.y,a=void 0===s?0:s,n=t.z;return[i,a,void 0===n?0:n].join()},spaceLabel:function(){return this.enu?"ENU:"+this.enu.lat+","+this.enu.lng:this.crs?""+this.crs.code:""}},methods:{clear:function(){this.compress=!1,this.hasMetaData=!1,this.file=null,this.name="",this.enu=null,this.crs=null,this.originOffset={x:0,y:0,z:0},this.textureFormat=f.a.DEFAULT,this.action=n.a.ADD,this.id=null},show:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.clear();var i=e.files,s=void 0===i?[]:i,a=e.id,l=void 0===a?null:a,r=e.action,o=void 0===r?n.a.ADD:r;if(s=s||[],this.action=o,this.id=l,o===n.a.ADD)s.length>0&&(this.file=u()({},s[0])),this.queryMetaData();else{var c={id:l,success:function(e){var i=e||{},a=i.name,n=void 0===a?null:a,r=i.detail,o=void 0===r?{}:r,c=o.tile,h=void 0===c?{}:c,p=o.source,d=void 0===p?{}:p;t.name=n;var m=d.enu,g=d.crs;t.originOffset=d.origin_offset||{x:0,y:0,z:0};var _=d.path,C=h.draco,y=void 0===C?{}:C,b=h.texture,x=void 0===b?{}:b,S=y.compress,w=void 0!==S&&S,D=x.format,O=void 0===D?f.a.DEFAULT:D;t.compress=w,t.textureFormat=O;var E={id:l,params:{path:_,type:v.b.OSGB},success:function(e){var i=e=e||{},a=i.enu,n=void 0===a?null:a,l=i.crs,r=void 0===l?null:l;if(t.hasMetaData=!(!n&&!r),s.length>0){t.file=u()({},s[0]);var o=t.file||{},c=o.path,h=o.name,p={id:o.id,params:{path:c,name:h,type:v.b.OSGB},success:function(e){var i=e=e||{},s=i.enu,a=void 0===s?null:s,n=i.crs,l=void 0===n?null:n,r=i.origin_offset,o=void 0===r?{x:0,y:0,z:0}:r;a||l?(t.hasMetaData=!0,t.enu=a,t.crs=l,t.originOffset=u()({},o)):(t.hasMetaData=!1,t.originOffset=u()({},o))}};t.$http.getOsgbMetaData(p)}else t.file={path:_},t.enu=m,t.crs=g}};t.$http.getOsgbMetaData(E)}};this.$http.getTileset3DByID(c)}},queryMetaData:function(){var t=this,e=this.file||{},i=e.path,s=e.name,a={id:e.id,params:{path:i,name:s,type:v.b.OSGB},success:function(e){var i=e=e||{},s=i.enu,a=void 0===s?null:s,n=i.crs,l=void 0===n?null:n,r=i.origin_offset,o=void 0===r?{x:0,y:0,z:0}:r;t.enu=a,t.crs=l,t.enu||t.crs?t.hasMetaData=!0:t.hasMetaData=!1,t.originOffset=u()({},o)}};this.$http.getOsgbMetaData(a)},reUpload:function(){this.$emit("previous",{step:2})},handleOk:function(){var t=this;if(m.b(this.name))return Object(a.a)("名称不能为空!"),!1;if(!this.file)return Object(a.a)("路径不能为空!"),!1;if(!this.enu&&!this.crs)return Object(a.a)("空间参考不能为空!"),!1;var e={name:this.name,path:this.path,enu:this.enu?{lng:this.enu.lng,lat:this.enu.lat}:null,crs:this.crs?{code:this.crs.code,proj4:this.crs.proj4,wkt:this.crs.wkt}:null,origin_offset:this.originOffset?u()({},this.originOffset):null,compress:this.compress,textureFormat:this.textureFormat},i=h.a.createOsgb(e);if(!i)return Object(a.a)("参数错误!"),!1;this.action==n.a.ADD?this.$Modal.confirm({title:"提示",content:"<p>确定要发布切片服务吗？</p>",onOk:function(){var e={params:i,success:function(e){t.goNext()}};t.$http.createTileset3D(e)}}):this.$Modal.confirm({title:"提示",content:"<p>确定要修改切片服务吗？</p>",onOk:function(){var e={params:i,id:t.id,success:function(e){t.goNext()}};t.$http.updateTileset3D(e)}})},showKJCKDialog:function(){this.$refs.kjckDialog.show({enu:this.enu,crs:this.crs})},goNext:function(){this.$emit("next",{step:2})},handleOnSetKJCK:function(t){this.enu=t.enu,this.crs=t.crs},showOriginOffsetDialog:function(){this.$refs.originOffsetDialog.show(this.originOffset)},handleOnSet:function(t){this.originOffset=u()({},t)}}},_={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._m(0),t._v(" "),i("Row",{staticClass:"row-item-split",attrs:{gutter:30,type:"flex"}},[i("Col",{attrs:{span:"12"}},[i("Input",{attrs:{placeholder:"请输入名称,长度不能超过64",maxlength:64},model:{value:t.name,callback:function(e){t.name="string"==typeof e?e.trim():e},expression:"name"}})],1),t._v(" "),i("Col",{attrs:{span:"12"}},[i("Input",{attrs:{disabled:""},model:{value:t.path,callback:function(e){t.path="string"==typeof e?e.trim():e},expression:"path"}})],1)],1),t._v(" "),t._m(1),t._v(" "),t.hasMetaData?i("Row",{staticClass:"row-item-split",attrs:{gutter:30,type:"flex"}},[i("Col",{attrs:{span:"12"}},[i("Input",{attrs:{disabled:"",placeholder:"请设置空间参考"},model:{value:t.spaceLabel,callback:function(e){t.spaceLabel=e},expression:"spaceLabel"}})],1),t._v(" "),i("Col",{attrs:{span:"12"}},[i("Input",{attrs:{disabled:""},model:{value:t.originOffsetLabel,callback:function(e){t.originOffsetLabel=e},expression:"originOffsetLabel"}})],1)],1):i("Row",{staticClass:"row-item-split",attrs:{gutter:30,type:"flex"}},[i("Col",{attrs:{span:"12"}},[i("Row",{attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"21"}},[i("Input",{attrs:{disabled:"",placeholder:"请设置空间参考"},model:{value:t.spaceLabel,callback:function(e){t.spaceLabel=e},expression:"spaceLabel"}})],1),t._v(" "),i("Col",{staticStyle:{"text-align":"right"},attrs:{span:"3"}},[i("span",{staticClass:"content-text-default span-split",on:{click:t.showKJCKDialog}},[t._v("设置")])])],1)],1),t._v(" "),i("Col",{attrs:{span:"12"}},[i("Row",{attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"21"}},[i("Input",{attrs:{disabled:""},model:{value:t.originOffsetLabel,callback:function(e){t.originOffsetLabel=e},expression:"originOffsetLabel"}})],1),t._v(" "),i("Col",{staticStyle:{"text-align":"right"},attrs:{span:"3"}},[i("span",{staticClass:"content-text-default span-split",on:{click:t.showOriginOffsetDialog}},[t._v("设置")])])],1)],1)],1),t._v(" "),t._m(2),t._v(" "),i("Row",{staticClass:"row-item-split",attrs:{gutter:30,type:"flex"}},[i("Col",{staticStyle:{display:"flex","align-items":"center"},attrs:{span:"12"}},[i("Checkbox",{model:{value:t.compress,callback:function(e){t.compress=e},expression:"compress"}},[t._v("压缩")])],1),t._v(" "),i("Col",{attrs:{span:"12"}},[i("Select",{model:{value:t.textureFormat,callback:function(e){t.textureFormat=e},expression:"textureFormat"}},t._l(t.textureArr,function(e){return i("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1)],1)],1),t._v(" "),i("div",{staticStyle:{display:"flex","flex-direction":"row","align-items":"center","justify-content":"flex-end",width:"100%","margin-top":"16px"}},[i("Button",{staticStyle:{float:"right","margin-right":"16px"},on:{click:t.reUpload}},[t._v(t._s(t.action==t.ACTIONS.ADD?"重新上传":"上一步"))]),t._v(" "),i("Button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:t.handleOk}},[t._v("确定")])],1),t._v(" "),i("KJCKDialog",{ref:"kjckDialog",on:{"on-set":t.handleOnSetKJCK}}),t._v(" "),i("OriginOffsetDialog",{ref:"originOffsetDialog",on:{"on-set":t.handleOnSet}})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"i-s-item"},[e("div",{staticClass:"left-pannel"},[e("span",[this._v("*")]),this._v("名称")]),this._v(" "),e("div",{staticClass:"right-pannel"},[e("span",[this._v("*")]),this._v("路径")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"i-s-item row-item-split"},[e("div",{staticClass:"left-pannel"},[e("span",[this._v("*")]),this._v("空间参考")]),this._v(" "),e("div",{staticClass:"right-pannel"},[e("span"),this._v("零点坐标")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"i-s-item row-item-split"},[e("div",{staticClass:"left-pannel"},[e("span"),this._v("顶点压缩")]),this._v(" "),e("div",{staticClass:"right-pannel"},[e("span"),this._v("纹理格式")])])}]};var C=i("C7Lr")(g,_,!1,function(t){i("4O6x")},"data-v-4ec57e36",null).exports,y={components:{Dialog:s.a,FirstStep:o,SecondStep:C},data:function(){return{visible:!1,total:2,curStep:1,titles:["上传模型","发布切片"],action:n.a.ADD,id:null}},computed:{title:function(){return this.titles?this.action+"----"+this.titles[this.curStep-1]:""}},methods:{clear:function(){this.visible=!1,this.curStep=1,this.action=n.a.ADD,this.id=null},show:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.clear();var e=t.action,i=void 0===e?n.a.ADD:e,s=t.id,a=void 0===s?null:s;this.action=i,this.id=a,this.$refs.firstStep&&this.$refs.firstStep.clear(),this.visible=!0},handleClose:function(){this.visible=!1,this.$emit("close-fb")},nextStep:function(t){if(1==t.step){var e=t.files||null;this.action==n.a.ADD?e&&e.length>0&&(this.$refs.secondStep&&this.$refs.secondStep.show({files:e,id:this.id,action:this.action}),this.curStep++):(this.$refs.secondStep&&this.$refs.secondStep.show({files:e,id:this.id,action:this.action}),this.curStep++)}else 2==t.step&&this.handleClose()},previousStep:function(t){if(2==t.step){var e=this.action===n.a.ADD;this.$refs.firstStep&&this.$refs.firstStep.clear(e),this.curStep--}}}},b={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Dialog",{attrs:{isShowBottomBtn:!1,title:t.title,visible:t.visible,showStep:!0,total:t.total,num:t.curStep,styles:{top:"20vh",width:"700px"}},on:{cus_cancel:t.handleClose}},[i("FirstStep",{directives:[{name:"show",rawName:"v-show",value:1===t.curStep,expression:"curStep === 1"}],ref:"firstStep",attrs:{action:t.action},on:{next:t.nextStep}}),t._v(" "),i("SecondStep",{directives:[{name:"show",rawName:"v-show",value:2===t.curStep,expression:"curStep === 2"}],ref:"secondStep",on:{next:t.nextStep,previous:t.previousStep}})],1)},staticRenderFns:[]};var x=i("C7Lr")(y,b,!1,function(t){i("DgzN")},"data-v-45ba4032",null);e.a=x.exports},j3sH:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("RuWt"),a=i("tIHl"),n=i("TPXC"),l=i("brHk"),r=i("fsLt"),o=i("6tbM"),c=i("oFuF"),u=i("h72K"),h={components:{CsPage:n.a,Tileset3DPreview:l.a,QXSYDialog:r.a,QXSYDetailDialog:o.a},mixins:[u.a],data:function(){return{isFB:!1,isRefresh:!0,timer:null,isNoData:!1,noDataImg:s.t,tilesetType:s.F,tilesetTypeArray:s.G,columns:[{title:"名称",key:"name",slot:"name",width:240,className:"table-header-text-default"},{title:"统计",key:"process_msg",minWidth:220,className:"table-header-text-default"},{title:"状态",key:"status",slot:"status",width:120,className:"table-header-text-default"},{title:"类型",key:"type",slot:"type",width:120,className:"table-header-text-default"},{title:"创建日期",key:"create_time",width:150,className:"table-header-text-default"},{title:"操作",slot:"action",align:"left",width:320,className:"table-header-text-default"}],list:[],key:"",current:1,pageSize:5*s.y,total:0,orderBy:s.x.DESC,fieldOrder:s.i.CREATE_TIME}},computed:{isDesc:function(){return this.orderBy==s.x.DESC}},mounted:function(){this.clear(),this.query(this.key,this.pageSize,this.current),this.isRefresh&&(this.timer=setInterval(this.timerFunc,s.K))},beforeDestroy:function(){this.timer&&clearInterval(this.timer)},methods:{handleCloseFB:function(){this.isFB=!1},handleCreateClick:function(t){switch(t){case s.F.TYPE_1:break;case s.F.TYPE_2:this.isFB=!0,this.$refs.qxsyDialog.show({action:s.a.ADD});break;case s.F.TYPE_3:case s.F.TYPE_4:}},isStart:function(t){return t.status!=s.C.STATUS_1},handleStopClick:function(t){var e=this;if(t.status!=s.C.STATUS_1)return Object(a.b)("任务未处理无法停止"),!1;var i=c.a.getConfirmContent("确定要停止任务吗？");this.$Modal.confirm({title:"提示",content:i,width:400,onOk:function(){var i={id:t.id,success:function(t){e.timerFunc()}};e.$http.stopTileset3DTask(i)}})},handleStartClick:function(t){var e=this;if(t.status==s.C.STATUS_1)return Object(a.b)("任务在处理中无法启动"),!1;var i=c.a.getConfirmContent("确定要启动任务吗？");this.$Modal.confirm({title:"提示",content:i,width:400,onOk:function(){var i={id:t.id,success:function(t){e.timerFunc()}};e.$http.startTileset3DTask(i)}})},handleChangeRefresh:function(){this.isRefresh=!this.isRefresh,this.isRefresh?this.timer=setInterval(this.timerFunc,s.K):this.timer&&clearInterval(this.timer)},startTimer:function(){this.timer=setInterval(this.timerFunc,s.K)},closeTimer:function(){this.timer&&clearInterval(this.timer)},getTypeLabel:c.a.getTileset3dTypeLabel,getTaskStatusLabel:c.a.getTaskStatusLabel,timerFunc:function(){this.query(this.key,this.pageSize,this.current)},handleRefresh:function(){this.query(this.key,this.pageSize,this.current)},handleTileStatus:function(t){console.log(t)},clear:function(){this.list=[],this.key="",this.current=1,this.pageSize=5*s.y,this.total=0},handleOrderByClick:function(){this.orderBy==s.x.DESC?this.orderBy=s.x.ASC:this.orderBy=s.x.DESC,this.query(this.key,this.pageSize,this.current)},handleSearch:function(){this.current=1,this.query(this.key,this.pageSize,this.current)},handleNewClick:function(){this.$refs.tilesetDialog&&this.$refs.tilesetDialog.show(s.w.CREATE)},handlePageSizeChange:function(t){this.pageSize=t,this.current=1,this.query(this.key,this.pageSize,this.current)},handleChangePage:function(t){this.current=t,this.query(this.key,this.pageSize,this.current)},query:function(t,e,i){var s=this;if(!this.isFB){var a={params:{key:t,page_size:e,page:i,sortby:this.fieldOrder,order:this.orderBy},success:function(t){t=t||{},s.total=t.total?t.total:0;var e=t.rows?t.rows:[];s.list=e}};this.$http.searchModelByKey(a)}},handleDeleteClick:function(t){var e=this;if(t.status==s.C.STATUS_1)return Object(a.b)("任务在处理中无法删除"),!1;var i=c.a.getDeleteContent(t.name);this.$Modal.confirm({title:"提示",content:i,width:400,onOk:function(){var i={id:t.id,success:function(t){t&&(e.current=e.computPageNum(e.total,e.pageSize,e.current,1),e.$bus.$emit(s.k.MODEL_STATISTICS),e.query(e.key,e.pageSize,e.current))}};e.$http.deleteTileset3DByID(i)}})},handlePreviewClick:function(t){this.offResize&&this.offResize(),this.closeTimer(),this.$refs.tileset3DPreview.show(t.id)},handleClose:function(){this.onResize&&this.onResize(),this.startTimer()},handleDetailClick:function(t){switch(t.type){case s.F.TYPE_1:break;case s.F.TYPE_2:this.$refs.qxsyDetailDialog.show(t.id)}},handleEditClick:function(t){if(t.status==s.C.STATUS_1)return Object(a.b)("任务在处理中无法编辑"),!1;switch(t.type){case s.F.TYPE_1:break;case s.F.TYPE_2:this.isFB=!0,this.$refs.qxsyDialog.show({action:s.a.EDIT,id:t.id});break;case s.F.TYPE_3:case s.F.TYPE_4:}},handlePreviewTileClick:function(t){if(t.status==s.C.STATUS_1)return Object(a.b)("任务在处理中无法预缓存"),!1;var e=this.$refs.tileCacheDialog;e&&e.show(t)},isEnable:function(t){return t.status==s.C.STATUS_1}}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{width:"100%",height:"100%"}},[i("div",{staticClass:"right-body"},[i("Row",{staticClass:"cus-view-search right-subject-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"18"}},[i("Input",{staticStyle:{width:"250px"},attrs:{search:"",placeholder:"搜索",suffix:"ios-search"},on:{"on-enter":t.handleSearch,"on-search":t.handleSearch},model:{value:t.key,callback:function(e){t.key="string"==typeof e?e.trim():e},expression:"key"}}),t._v(" "),i("span",{staticClass:"content-text-default span-split",staticStyle:{"font-size":"14px","margin-left":"10px"},on:{click:function(e){return e.stopPropagation(),t.handleOrderByClick.apply(null,arguments)}}},[i("Icon",{staticStyle:{"font-size":"16px"},attrs:{type:t.isDesc?"md-arrow-round-down":"md-arrow-round-up"}}),t._v("时间\n        ")],1)],1),t._v(" "),i("Col",{staticStyle:{"text-align":"right"},attrs:{span:"6"}},[i("div",{staticClass:"i-t_btn-default",on:{click:t.handleChangeRefresh}},[t._v("\n          "+t._s(t.isRefresh?"停止刷新":"启动刷新")+"\n        ")]),t._v(" "),i("Dropdown",{on:{"on-click":t.handleCreateClick}},[i("Button",{attrs:{type:"primary"}},[t._v("\n            发布\n            "),i("Icon",{attrs:{type:"ios-arrow-down"}})],1),t._v(" "),i("DropdownMenu",{attrs:{slot:"list"},slot:"list"},t._l(t.tilesetTypeArray,function(e){return i("DropdownItem",{key:e.value,attrs:{name:e.value}},[t._v(t._s(e.label))])}),1)],1)],1)],1),t._v(" "),i("div",{staticClass:"cus-view"},[i("Table",{attrs:{columns:t.columns,data:t.list,"max-height":t.tableHeight},scopedSlots:t._u([{key:"name",fn:function(e){var s=e.row;return[i("div",{staticClass:"label-ellipsis",attrs:{title:s.name}},[t._v(t._s(s.name))])]}},{key:"process_msg",fn:function(e){var s=e.row;return[i("div",[t._v(t._s(s.process_msg))])]}},{key:"status",fn:function(e){var s=e.row;return[i("div",[t._v(t._s(t.getTaskStatusLabel(s.status)))])]}},{key:"type",fn:function(e){var s=e.row;return[i("div",[t._v(t._s(t.getTypeLabel(s.type)))])]}},{key:"action",fn:function(e){var s=e.row;return[i("span",{staticClass:"content-text-default span-split",on:{click:function(e){return t.handleEditClick(s)}}},[i("i",{staticClass:"iconfont iconbianji- content-text-default"}),t._v("\n            编辑\n          ")]),t._v(" "),i("span",{staticClass:"content-text-default span-split",staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handleDetailClick(s)}}},[i("i",{staticClass:"iconfont iconxiangqing- content-text-default"}),t._v("\n            详情\n          ")]),t._v(" "),i("span",{staticClass:"content-text-default span-split",staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handleDeleteClick(s)}}},[i("i",{staticClass:"iconfont iconshanchu- content-text-default"}),t._v("\n            删除\n          ")]),t._v(" "),i("span",{staticClass:"content-text-default span-split",staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handlePreviewClick(s)}}},[i("i",{staticClass:"iconfont iconliulan- content-text-default"}),t._v("\n            预览\n          ")]),t._v(" "),t.isStart(s)?i("span",{staticClass:"content-text-default span-split",staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handleStartClick(s)}}},[i("i",{staticClass:"iconfont iconqidong- content-text-default"}),t._v("\n            启动\n          ")]):i("span",{staticClass:"content-text-default span-split",staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handleStopClick(s)}}},[i("i",{staticClass:"iconfont iconzanting- content-text-default"}),t._v("\n            停止\n          ")])]}}])}),t._v(" "),i("Row",{staticClass:"right-subject-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"24"}},[i("CsPage",{attrs:{current:t.current,"page-size":t.pageSize,total:t.total},on:{"on-page-size-change":t.handlePageSizeChange,"on-change":t.handleChangePage}})],1)],1)],1)],1),t._v(" "),i("Tileset3DPreview",{ref:"tileset3DPreview",on:{"comp-close":t.handleClose}}),t._v(" "),i("QXSYDialog",{ref:"qxsyDialog",on:{"close-fb":t.handleCloseFB}}),t._v(" "),i("QXSYDetailDialog",{ref:"qxsyDetailDialog"})],1)},staticRenderFns:[]};var d=i("C7Lr")(h,p,!1,function(t){i("SpM+")},"data-v-f34d8e3e",null);e.default=d.exports},lP4K:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var s={NONE:"none",OBJ:"obj",GLTF:"gltf",GLB:"glb",SHP:"shp",DB:"db",OSGB:"osgb",FBX:"fbx"},a=[{label:"SHP",value:s.SHP},{label:"OBJ",value:s.OBJ},{label:"FBX",value:s.FBX}];e.b=s},unTm:function(t,e){},uoUy:function(t,e,i){"use strict";i.d(e,"a",function(){return s}),i.d(e,"b",function(){return a}),e.c=function(t){var e=a.find(function(e){return e.value==t});return e?e.label:"未知"};var s={DEFAULT:"default",WEBP:"webp",KTX2:"ktx2"},a=[{value:s.DEFAULT,label:"默认"},{value:s.WEBP,label:"webp"},{value:s.KTX2,label:"ktx2"}]},vIFc:function(t,e){}});