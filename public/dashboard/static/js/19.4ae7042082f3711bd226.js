webpackJsonp([19],{TSsR:function(t,e){},hzFU:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("RuWt"),i=a("tIHl"),n=a("FCy9"),l=a("TPXC"),c=a("oFuF"),r=a("h72K"),o={components:{ImportDialog:n.a,CsPage:l.a},mixins:[r.a],data:function(){var t=this;return{isCheckAll:!1,taskStatusArray:s.D,status:s.C.STATUS_ALL,columns:[{title:"编号",key:"id",slot:"id",width:100,className:"table-header-text-default",renderHeader:function(e,a){return e("div",[e("i",{class:["iconfont",t.isCheckAll?"iconyixuan-":"iconkuang-"],style:{cursor:"pointer",verticalAlign:"middle",display:"inline-block"},on:{click:t.handleCheckChange}}),e("span",{style:{marginLeft:"10px",verticalAlign:"middle"}},a.column.title)])}},{title:"名称",key:"name",slot:"name",className:"table-header-text-default"},{title:"统计",key:"total_count",slot:"statics",width:300,className:"table-header-text-default"},{title:"状态",key:"status",slot:"status",width:80,className:"table-header-text-default"},{title:"创建时间",key:"create_time",width:180,className:"table-header-text-default"},{title:"操作",slot:"action",align:"left",width:150,className:"table-header-text-default"}],list:[],key:"",current:1,pageSize:5*s.y,total:0,orderBy:s.x.DESC,fieldOrder:s.i.CREATE_TIME}},computed:{isDesc:function(){return this.orderBy==s.x.DESC}},mounted:function(){this.clear(),this.queryTasks(this.status,this.pageSize,this.current)},methods:{getImportTaskStatusLabel:c.a.getImportTaskStatusLabel,handleCheckChange:function(){var t=this;this.isCheckAll=!this.isCheckAll,this.list.forEach(function(e){e.checked=t.isCheckAll})},handleCheckState:function(t){this.list.forEach(function(e){e.id==t.id&&(e.checked=!e.checked)}),this.setCheckAllState()},setCheckAllState:function(){if(!this.list||0==this.list.length)return this.isCheckAll=!1,!1;var t=this.list.find(function(t){return 0==t.checked});this.isCheckAll=!t},clear:function(){this.list=[],this.status=s.C.STATUS_ALL,this.current=1,this.pageSize=5*s.y,this.total=0,this.isCheckAll=!1},handleBatchDelete:function(){var t=this;if(!this.list||0==this.list.length)return!1;var e=this.list.filter(function(t){return 1==t.checked&&t.status==s.C.STATUS_2});if(!e||0==e.length)return Object(i.b)("请选择已完成的任务"),!1;var a=[],n=e.length;e.forEach(function(t){a.push(t.id)});var l=c.a.getDeleteContent("",!0);this.$Modal.confirm({title:"提示",content:l,width:380,onOk:function(){var e={params:{method:"delete",data:a},success:function(e){e&&(t.current=t.computPageNum(t.total,t.pageSize,t.current,n),t.$bus.$emit(s.k.DATA_STATISTICS),t.queryTasks(t.status,t.pageSize,t.current))}};t.$http.batchImportTasksByIDs(e)}})},handleOrderByClick:function(){this.orderBy==s.x.DESC?this.orderBy=s.x.ASC:this.orderBy=s.x.DESC,this.queryTasks(this.status,this.pageSize,this.current)},handleSearch:function(){this.current=1,this.queryTasks(this.status,this.pageSize,this.current)},handlePageSizeChange:function(t){this.pageSize=t,this.current=1,this.queryTasks(this.status,this.pageSize,this.current)},handleChangePage:function(t){this.current=t,this.queryTasks(this.status,this.pageSize,this.current)},queryTasks:function(t,e,a){var i=this,n={page_size:e,page:a,sortby:this.fieldOrder,order:this.orderBy,type:s.E.IMPORT_VECTOR_TASK};s.C.STATUS_ALL!=t&&(n.status=t);var l={params:n,success:function(t){t=t||{},i.total=t.total?t.total:0;var e=t.rows?t.rows:[];e.forEach(function(t){t.checked=!1}),i.list=e,i.setCheckAllState()}};this.$http.searchImportTaskByStatus(l)},handleDeleteClick:function(t){var e=this,a=c.a.getDeleteContent(t.name);this.$Modal.confirm({title:"提示",content:a,width:400,onOk:function(){var a={id:t.id,success:function(t){t&&(e.current=e.computPageNum(e.total,e.pageSize,e.current,1),e.$bus.$emit(s.k.DATA_STATISTICS),e.queryTasks(e.status,e.pageSize,e.current))}};e.$http.deleteImportTaskByID(a)}})},computeStaticsMsg:function(t){var e=t.total_count,a=t.current_count,s=t.total_count,i=void 0===s?0:s,n=t.success_count,l=void 0===n?0:n,c=t.fail_count;return"总数:"+i+"    成功:"+l+"    失败:"+(void 0===c?0:c)+"    进度:"+(0==t.total_count?100:Math.round(a/e*100))+"%"}}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{width:"100%",height:"100%"}},[a("div",{staticClass:"right-body"},[a("Row",{staticClass:"cus-view-search right-subject-item",attrs:{type:"flex",align:"middle"}},[a("Col",{attrs:{span:"20"}},[a("Select",{staticStyle:{width:"200px"},on:{"on-change":t.handleSearch},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},t._l(t.taskStatusArray,function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1),t._v(" "),a("span",{staticClass:"content-text-default span-split",staticStyle:{"font-size":"14px","margin-left":"10px"},on:{click:function(e){return e.stopPropagation(),t.handleOrderByClick.apply(null,arguments)}}},[a("Icon",{staticStyle:{"font-size":"16px"},attrs:{type:t.isDesc?"md-arrow-round-down":"md-arrow-round-up"}}),t._v("时间\n        ")],1)],1),t._v(" "),a("Col",{staticStyle:{"text-align":"right"},attrs:{span:"4"}},[a("div",{staticClass:"i-t_btn",on:{click:t.handleBatchDelete}},[t._v("批量删除")])])],1),t._v(" "),a("div",{staticClass:"cus-view"},[a("Table",{attrs:{columns:t.columns,data:t.list,"max-height":t.tableHeight},scopedSlots:t._u([{key:"id",fn:function(e){var s=e.row;return[s.checked?a("i",{staticClass:"iconfont iconyixuan-",staticStyle:{cursor:"pointer","vertical-align":"middle",display:"inline-block"},on:{click:function(e){return t.handleCheckState(s)}}}):a("i",{staticClass:"iconfont iconkuang-",staticStyle:{cursor:"pointer","vertical-align":"middle",display:"inline-block"},on:{click:function(e){return t.handleCheckState(s)}}}),t._v(" "),a("span",{staticStyle:{"margin-left":"6px","vertical-align":"middle"}},[t._v(t._s(s.id))])]}},{key:"name",fn:function(e){var s=e.row;return[a("div",{staticClass:"label-ellipsis",attrs:{title:s.name}},[t._v(t._s(s.name))])]}},{key:"statics",fn:function(e){var s=e.row;return[a("div",[t._v(t._s(t.computeStaticsMsg(s)))])]}},{key:"status",fn:function(e){var s=e.row;return[a("div",[t._v(t._s(t.getImportTaskStatusLabel(s.status)))])]}},{key:"action",fn:function(e){var s=e.row;return[a("span",{staticClass:"content-text-default span-split",on:{click:function(e){return t.handleDeleteClick(s)}}},[a("i",{staticClass:"iconfont iconshanchu- content-text-default"}),t._v("\n            删除\n          ")])]}}])}),t._v(" "),a("Row",{staticClass:"right-subject-item",attrs:{type:"flex",align:"middle"}},[a("Col",{attrs:{span:"24"}},[a("CsPage",{attrs:{current:t.current,"page-size":t.pageSize,total:t.total},on:{"on-page-size-change":t.handlePageSizeChange,"on-change":t.handleChangePage}})],1)],1)],1)],1),t._v(" "),a("ImportDialog",{ref:"importDialog"})],1)},staticRenderFns:[]};var h=a("C7Lr")(o,u,!1,function(t){a("TSsR")},"data-v-5edbe5b2",null);e.default=h.exports}});