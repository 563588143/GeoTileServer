webpackJsonp([16],{fvth:function(t,e){},yLHZ:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("RuWt"),a=i("tIHl"),n=i("FCy9"),r=i("TPXC"),c=i("oFuF"),l=i("h72K"),o={components:{ImportDialog:n.a,CsPage:r.a},mixins:[l.a],data:function(){var t=this;return{timer:null,isCheckAll:!1,taskStatusArray:s.H,status:s.C.STATUS_ALL,columns:[{title:"编号",key:"bh",slot:"id",width:100,className:"table-header-text-default",renderHeader:function(e,i){return e("div",[e("i",{class:["iconfont",t.isCheckAll?"iconyixuan-":"iconkuang-"],style:{cursor:"pointer",verticalAlign:"middle",display:"inline-block"},on:{click:t.handleCheckChange}}),e("span",{style:{marginLeft:"10px",verticalAlign:"middle"}},i.column.title)])}},{title:"名称",key:"name",slot:"name",className:"table-header-text-default"},{title:"统计",key:"total_count",slot:"statics",width:320,className:"table-header-text-default"},{title:"任务进度",key:"current",width:200,className:"table-header-text-default"},{title:"状态",key:"status",slot:"status",width:80,className:"table-header-text-default"},{title:"创建时间",key:"create_time",width:180,className:"table-header-text-default"},{title:"操作",slot:"action",align:"left",width:150,className:"table-header-text-default"}],list:[],key:"",current:1,pageSize:5*s.y,total:0,orderBy:s.x.DESC,fieldOrder:s.i.CREATE_TIME,isRefresh:!0}},computed:{isDesc:function(){return this.orderBy==s.x.DESC}},mounted:function(){this.clear(),this.queryTasks(this.status,this.pageSize,this.current),this.isRefresh&&(this.timer=setInterval(this.timerFunc,s.K))},methods:{getTilesetTaskStatusLabel:c.a.getTaskStatusLabel,timerFunc:function(){this.queryTasks(this.status,this.pageSize,this.current)},handleChangeRefresh:function(){this.isRefresh=!this.isRefresh,this.isRefresh?this.timer=setInterval(this.timerFunc,s.K):this.timer&&clearInterval(this.timer)},handleCheckChange:function(){var t=this;this.isCheckAll=!this.isCheckAll,this.list.forEach(function(e){e.checked=t.isCheckAll})},handleCheckState:function(t){this.list.forEach(function(e){e.id==t.id&&(e.checked=!e.checked)}),this.setCheckAllState()},setCheckAllState:function(){if(!this.list||0==this.list.length)return this.isCheckAll=!1,!1;var t=this.list.find(function(t){return 0==t.checked});this.isCheckAll=!t},clear:function(){this.list=[],this.status=s.C.STATUS_ALL,this.current=1,this.pageSize=5*s.y,this.total=0,this.isCheckAll=!1},handleBatchDelete:function(){var t=this;if(!this.list||0==this.list.length)return!1;var e;if((e=this.list.filter(function(t){return 1==t.checked&&t.status==s.C.STATUS_1}))&&e.length>0)return Object(a.b)("正在处理的任务无法删除"),!1;var i=this.list.filter(function(t){return 1==t.checked&&t.status!=s.C.STATUS_1});if(!i||0==i.length)return Object(a.b)("请先选择需要删除的任务"),!1;var n=[],r=i.length;i.forEach(function(t){n.push(t.id)});var l=c.a.getDeleteContent("",!0);this.$Modal.confirm({title:"提示",content:l,width:380,onOk:function(){var e={params:{method:"delete",data:n},success:function(e){e&&(t.current=t.computPageNum(t.total,t.pageSize,t.current,r),t.$bus.$emit(s.k.DATA_STATISTICS),t.queryTasks(t.status,t.pageSize,t.current))}};t.$http.batchTilesetTasksByIDs(e)}})},handleOrderByClick:function(){this.orderBy==s.x.DESC?this.orderBy=s.x.ASC:this.orderBy=s.x.DESC,this.queryTasks(this.status,this.pageSize,this.current)},handleSearch:function(){this.current=1,this.queryTasks(this.status,this.pageSize,this.current)},handlePageSizeChange:function(t){this.pageSize=t,this.current=1,this.queryTasks(this.status,this.pageSize,this.current)},handleChangePage:function(t){this.current=t,this.queryTasks(this.status,this.pageSize,this.current)},queryTasks:function(t,e,i){var a=this,n={page_size:e,page:i,sortby:this.fieldOrder,order:this.orderBy};s.C.STATUS_ALL!=t&&(n.status=t);var r={params:n,success:function(t){t=t||{},a.total=t.total?t.total:0;var e=t.rows?t.rows:[];e.forEach(function(t,e){t.checked=!1,t.bh=e+1}),a.list=e,a.setCheckAllState()}};this.$http.searchTilesetTaskByStatus(r)},handleDeleteClick:function(t){var e=this;if(t.status==s.C.STATUS_1)return Object(a.b)("正在处理的任务无法删除"),!1;var i=c.a.getDeleteContent(t.name);this.$Modal.confirm({title:"提示",content:i,width:400,onOk:function(){var i={id:t.id,success:function(t){t&&(e.current=e.computPageNum(e.total,e.pageSize,e.current,1),e.$bus.$emit(s.k.DATA_STATISTICS),e.queryTasks(e.status,e.pageSize,e.current))}};e.$http.deleteTilesetTaskByID(i)}})},handleStopClick:function(t){var e=this;if(t.status!=s.C.STATUS_1)return Object(a.b)("任务未处理无法停止"),!1;var i=c.a.getConfirmContent("确定要停止任务吗？");this.$Modal.confirm({title:"提示",content:i,width:400,onOk:function(){var i={id:t.id,success:function(t){e.queryTasks(e.status,e.pageSize,e.current)}};e.$http.stopTilesetTask(i)}})},handleStartClick:function(t){var e=this;if(t.status==s.C.STATUS_1)return Object(a.b)("任务在处理中无法启动"),!1;var i=c.a.getConfirmContent("确定要启动任务吗？");this.$Modal.confirm({title:"提示",content:i,width:400,onOk:function(){var i={id:t.id,success:function(t){e.queryTasks(e.status,e.pageSize,e.current)}};e.$http.startTilesetTask(i)}})},isStart:function(t){return t.status!=s.C.STATUS_1},isEnable:function(t){return t.status==s.C.STATUS_1},computeStaticsMsg:function(t){var e=t.total_count,i=t.current_count,s=t.total_count,a=void 0===s?0:s,n=t.success_count,r=void 0===n?0:n,c=t.fail_count;return"总数:"+a+"    成功:"+r+"    失败:"+(void 0===c?0:c)+"    进度:"+(0==t.total_count?100:Math.round(i/e*100))+"%"}},beforeDestroy:function(){this.timer&&clearInterval(this.timer)}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{width:"100%",height:"100%"}},[i("div",{staticClass:"right-body"},[i("Row",{staticClass:"cus-view-search right-subject-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"12"}},[i("Select",{staticStyle:{width:"200px"},on:{"on-change":t.handleSearch},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},t._l(t.taskStatusArray,function(e){return i("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1),t._v(" "),i("span",{staticClass:"content-text-default span-split",staticStyle:{"font-size":"14px","margin-left":"10px"},on:{click:function(e){return e.stopPropagation(),t.handleOrderByClick.apply(null,arguments)}}},[i("Icon",{staticStyle:{"font-size":"16px"},attrs:{type:t.isDesc?"md-arrow-round-down":"md-arrow-round-up"}}),t._v("时间\n        ")],1)],1),t._v(" "),i("Col",{staticStyle:{"text-align":"right"},attrs:{span:"12"}},[i("div",{staticClass:"i-t_btn-default",on:{click:t.handleChangeRefresh}},[t._v(t._s(t.isRefresh?"停止刷新":"启动刷新"))]),t._v(" "),i("div",{staticClass:"i-t_btn",on:{click:t.handleBatchDelete}},[t._v("批量删除")])])],1),t._v(" "),i("div",{staticClass:"cus-view"},[i("Table",{attrs:{columns:t.columns,data:t.list,"max-height":t.tableHeight},scopedSlots:t._u([{key:"id",fn:function(e){var s=e.row;return[s.checked?i("i",{staticClass:"iconfont iconyixuan-",staticStyle:{cursor:"pointer","vertical-align":"middle",display:"inline-block"},on:{click:function(e){return t.handleCheckState(s)}}}):i("i",{staticClass:"iconfont iconkuang-",staticStyle:{cursor:"pointer","vertical-align":"middle",display:"inline-block"},on:{click:function(e){return t.handleCheckState(s)}}}),t._v(" "),i("span",{staticStyle:{"margin-left":"6px","vertical-align":"middle"}},[t._v(t._s(s.bh))])]}},{key:"name",fn:function(e){var s=e.row;return[i("div",{staticClass:"label-ellipsis",attrs:{title:s.name}},[t._v(t._s(s.name))])]}},{key:"statics",fn:function(e){var s=e.row;return[i("div",[t._v(t._s(t.computeStaticsMsg(s)))])]}},{key:"status",fn:function(e){var s=e.row;return[i("div",[t._v(t._s(t.getTilesetTaskStatusLabel(s.status)))])]}},{key:"action",fn:function(e){var s=e.row;return[i("span",{staticClass:"content-text-default span-split",on:{click:function(e){return t.handleDeleteClick(s)}}},[i("i",{staticClass:"iconfont iconshanchu- content-text-default"}),t._v("\n            删除\n          ")]),t._v(" "),t.isStart(s)?i("span",{staticClass:"content-text-default span-split",staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handleStartClick(s)}}},[i("i",{staticClass:"iconfont iconqidong- content-text-default"}),t._v("\n            启动\n          ")]):i("span",{staticClass:"content-text-default span-split",staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handleStopClick(s)}}},[i("i",{staticClass:"iconfont iconzanting- content-text-default"}),t._v("\n            停止\n          ")])]}}])}),t._v(" "),i("Row",{staticClass:"right-subject-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"24"}},[i("CsPage",{attrs:{current:t.current,"page-size":t.pageSize,total:t.total},on:{"on-page-size-change":t.handlePageSizeChange,"on-change":t.handleChangePage}})],1)],1)],1)],1),t._v(" "),i("ImportDialog",{ref:"importDialog"})],1)},staticRenderFns:[]};var h=i("C7Lr")(o,u,!1,function(t){i("fvth")},"data-v-d0fa3350",null);e.default=h.exports}});