webpackJsonp([14],{Cdc9:function(t,e){},UZis:function(t,e){},V7VK:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("4YfN"),s=i.n(a),n=i("RuWt"),l=(i("tIHl"),i("FCy9")),o=i("deIM"),r=i("TPXC"),c=i("bYIx"),h=i("T452"),d=i("Izdj"),u={components:{Dialog:o.a,CsPage:r.a},mixins:[d.a],data:function(){return{tableHeight:0,visible:!1,map:null,title:"数据预览",bSwitchMap:!0,columns:[],pageSize:5*n.y,total:0,current:1,list:[],fields:[],dtId:null}},computed:{},watch:{totalHeight:function(t){this.tableHeight=t>0?t-113:0}},methods:{clear:function(){this.dtId=null,this.title="数据预览",this.bSwitchMap=!0,this.columns=[],this.total=0,this.current=1,this.list=[],this.fields=[]},handleClose:function(){this.clear(),this.tableHeight=0,this.map&&this.map.remove(),this.map=null,this.offResize&&this.offResize(),this.visible=!1,this.$emit("vtp-close")},show:function(t){var e=this;this.clear(),this.onResize&&this.onResize(),this.dtId=t;var i={id:t,success:function(i){var a=i||{},s=a.bounds,l=void 0===s?null:s,o=a.srs,r=void 0===o?null:o,d=a.type,u=void 0===d?0:d,p=a.name,f=void 0===p?null:p,m=a.fields,g=void 0===m?[]:m;e.fields=[],e.columns=[],g.forEach(function(t){e.fields.push(t.name),e.columns.push({title:t.name,key:t.name,className:"table-header-text-default",ellipsis:!0,minWidth:150})}),e.title=f?"【"+f+"】数据预览":"数据预览";e.map=new zcloud.Map({container:"map",attributionControl:!0,zoom:5,maxZoom:22,minZoom:0,center:[116.5007,39.8545],style:{version:8,id:"vt-pre",name:"vt-pre",sources:{},layers:[{id:"background",type:"background",layout:{},paint:{"background-color":"rgb(0,0,0)"}}]},hash:!1}),e.map.showTileBoundaries=!1;var v=new zcloud.NavigationControl({showCompass:!0,showZoom:!0,visualizePitch:!0});e.map.addControl(v,"top-right"),e.map.on("load",function(){var i=Object(h.a)("datasets/"+t+"/tile/{z}/{x}/{y}.vector.pbf",!0),a={id:f,source:{type:"vector",tiles:[i],maxzoom:22,minzoom:0},"source-layer":f};switch(u){case n.n.POINT:a.type="circle",a.paint={"circle-radius":5,"circle-color":"#0079F2"};break;case n.n.LINE:a.type="line",a.paint={"line-color":"#0079F2","line-width":2};break;case n.n.POLYGON:a.type="fill",a.paint={"fill-color":"#0079F2","fill-outline-color":"#320064"}}if(l){var s=null,o=r||{},d=o.srid,p=void 0===d?4326:d,m=o.wkt;if(4326!=p)s=[Object(c.a)(m).inverse([l.min_x,l.min_y]),Object(c.a)(m).inverse([l.max_x,l.max_y])];else s=[[l.min_x,l.min_y],[l.max_x,l.max_y]];e.map.fitBounds(s)}e.map.addLayer(a)}),e.queryAttributes(t,e.fields,e.pageSize,e.current)}};this.$http.getDatasetDetailByID(i),this.visible=!0},handlePageSizeChange:function(t){this.current=1,this.pageSize=t,this.queryAttributes(this.dtId,this.fields,this.pageSize,this.current)},handleChangePage:function(t){this.current=t,this.queryAttributes(this.dtId,this.fields,this.pageSize,this.current)},queryAttributes:function(t,e,i,a){var s=this,n={params:{id:t,query:{fields:e||[]},page:a,page_size:i},success:function(t){var e=t=t||{},i=(e.fields,e.rows),a=void 0===i?[]:i,n=e.total,l=void 0===n?0:n;s.list=a,s.total=l}};this.$http.getAttributesByDtID(n)}}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Dialog",{staticClass:"cus-view",attrs:{isShowBottomBtn:!1,fullscreen:!0,title:t.title,visible:t.visible,showStep:!1},on:{cus_cancel:t.handleClose}},[i("div",{staticClass:"v-t-d-containter"},[i("div",{style:{zIndex:t.bSwitchMap?10:0},attrs:{id:"map"}}),t._v(" "),i("div",{staticClass:"attrs-containter",style:{zIndex:t.bSwitchMap?0:10}},[i("Table",{staticClass:"cus-view",attrs:{border:"",columns:t.columns,data:t.list,height:t.tableHeight}}),t._v(" "),i("Row",{staticClass:"cus-view",staticStyle:{"padding-top":"16px"},attrs:{type:"flex",justify:"end",align:"middle"}},[i("Col",{attrs:{span:"24"}},[i("CsPage",{attrs:{current:t.current,"page-size":t.pageSize,total:t.total},on:{"on-page-size-change":t.handlePageSizeChange,"on-change":t.handleChangePage}})],1)],1)],1),t._v(" "),i("div",{staticClass:"r-t-containter",style:{right:t.bSwitchMap?"20px":"0px",bottom:t.bSwitchMap?"20px":"0px"}},[i("span",{class:[t.bSwitchMap?"":"view-select"],on:{click:function(e){t.bSwitchMap=!1}}},[i("i",{staticClass:"iconfont iconbiaoge"})]),t._v(" "),i("span",{class:[t.bSwitchMap?"view-select":""],on:{click:function(e){t.bSwitchMap=!0}}},[i("i",{staticClass:"iconfont icongonggongditu"})])])])])},staticRenderFns:[]};var f=i("C7Lr")(u,p,!1,function(t){i("Cdc9")},"data-v-797f8f80",null).exports,m=i("oFuF"),g=i("h72K"),v=i("bSIt"),y={components:{ImportDialog:l.a,CsPage:r.a,VectorDataPreview:f},mixins:[g.a],data:function(){return{isNoData:!1,noDataImg:n.t,columns:[{title:"名称",key:"name",slot:"name",className:"table-header-text-default"},{title:"数据量",key:"count",width:120,className:"table-header-text-default"},{title:"坐标系",key:"srid",slot:"srid",width:120,className:"table-header-text-default"},{title:"类型",key:"type",slot:"type",width:120,className:"table-header-text-default"},{title:"创建日期",key:"create_time",width:200,className:"table-header-text-default"},{title:"操作",slot:"action",align:"left",width:200,className:"table-header-text-default"}],list:[],key:"",current:1,pageSize:5*n.y,total:0,orderBy:n.x.DESC,fieldOrder:n.i.CREATE_TIME}},computed:s()({isDesc:function(){return this.orderBy==n.x.DESC}},Object(v.b)(["host"])),mounted:function(){this.clear(),this.queryDatasets(this.key,this.pageSize,this.current)},methods:{getDatasetTypeLabel:m.a.getDatasetTypeLabel,clear:function(){this.list=[],this.key="",this.current=1,this.pageSize=5*n.y,this.total=0},handleOrderByClick:function(){this.orderBy==n.x.DESC?this.orderBy=n.x.ASC:this.orderBy=n.x.DESC,this.queryDatasets(this.key,this.pageSize,this.current)},handleSearch:function(){this.current=1,this.queryDatasets(this.key,this.pageSize,this.current)},handleImport:function(){this.$refs.importDialog&&this.$refs.importDialog.show()},handlePageSizeChange:function(t){this.pageSize=t,this.current=1,this.queryDatasets(this.key,this.pageSize,this.current)},handleChangePage:function(t){this.current=t,this.queryDatasets(this.key,this.pageSize,this.current)},queryDatasets:function(t,e,i){var a=this,s={params:{key:t,page_size:e,page:i,sortby:this.fieldOrder,order:this.orderBy},success:function(t){t=t||{},a.total=t.total?t.total:0,a.total=t.total?t.total:0;var e=t.rows?t.rows:[];a.list=e}};this.$http.searchDatasetsByKey(s)},handleEditClick:function(t){window.open(this.host+"/apps/edit/vector?id="+t.id)},handleDeleteClick:function(t){var e=this,i=m.a.getDeleteContent(t.name);this.$Modal.confirm({title:"提示",content:i,width:400,onOk:function(){var i={id:t.id,success:function(t){t&&(e.current=e.computPageNum(e.total,e.pageSize,e.current,1),e.$bus.$emit(n.k.DATA_STATISTICS),e.queryDatasets(e.key,e.pageSize,e.current))}};e.$http.deleteDatasetByID(i)}})},handlePreviewClick:function(t){this.offResize&&this.offResize(),this.$refs.vtPreview.show(t.id)},handleVtpClose:function(){this.onResize&&this.onResize()},handleRefrsh:function(){this.queryDatasets(this.key,this.pageSize,this.current)}}},b={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{width:"100%",height:"100%"}},[i("div",{staticClass:"right-body"},[i("Row",{staticClass:"cus-view-search right-subject-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"20"}},[i("Input",{staticStyle:{width:"250px"},attrs:{search:"",placeholder:"搜索",suffix:"ios-search"},on:{"on-enter":t.handleSearch,"on-search":t.handleSearch},model:{value:t.key,callback:function(e){t.key="string"==typeof e?e.trim():e},expression:"key"}}),t._v(" "),i("span",{staticClass:"content-text-default span-split",staticStyle:{"font-size":"14px","margin-left":"10px"},on:{click:function(e){return e.stopPropagation(),t.handleOrderByClick.apply(null,arguments)}}},[i("Icon",{staticStyle:{"font-size":"16px"},attrs:{type:t.isDesc?"md-arrow-round-down":"md-arrow-round-up"}}),t._v("时间\n        ")],1)],1),t._v(" "),i("Col",{staticStyle:{"text-align":"right"},attrs:{span:"4"}},[i("div",{staticClass:"upload_btn",on:{click:t.handleImport}},[t._v("上传数据")])])],1),t._v(" "),i("div",{staticClass:"cus-view"},[i("Table",{attrs:{columns:t.columns,data:t.list,"max-height":t.tableHeight},scopedSlots:t._u([{key:"name",fn:function(e){var a=e.row;return[i("div",{staticClass:"label-ellipsis",attrs:{title:a.name}},[t._v(t._s(a.name))])]}},{key:"type",fn:function(e){var a=e.row;return[i("div",[t._v(t._s(t.getDatasetTypeLabel(a.type)))])]}},{key:"srid",fn:function(e){var a=e.row;return[i("div",[t._v(t._s("EPSG:"+a.srid))])]}},{key:"action",fn:function(e){var a=e.row;return[i("span",{staticClass:"content-text-default span-split",on:{click:function(e){return t.handlePreviewClick(a)}}},[i("i",{staticClass:"iconfont iconliulan-"}),t._v("\n            预览\n          ")]),t._v(" "),i("span",{staticClass:"content-text-default span-split",staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handleEditClick(a)}}},[i("i",{staticClass:"iconfont iconbianji- content-text-default"}),t._v("\n            编辑\n          ")]),t._v(" "),i("span",{staticClass:"content-text-default span-split",staticStyle:{"margin-left":"10px"},on:{click:function(e){return t.handleDeleteClick(a)}}},[i("i",{staticClass:"iconfont iconshanchu- content-text-default"}),t._v("\n            删除\n          ")])]}}])}),t._v(" "),i("Row",{staticClass:"right-subject-item",attrs:{type:"flex",align:"middle"}},[i("Col",{attrs:{span:"24"}},[i("CsPage",{attrs:{current:t.current,"page-size":t.pageSize,total:t.total},on:{"on-page-size-change":t.handlePageSizeChange,"on-change":t.handleChangePage}})],1)],1)],1)],1),t._v(" "),i("ImportDialog",{ref:"importDialog",on:{refrsh:t.handleRefrsh}}),t._v(" "),i("VectorDataPreview",{ref:"vtPreview",on:{"vtp-close":t.handleVtpClose}})],1)},staticRenderFns:[]};var C=i("C7Lr")(y,b,!1,function(t){i("UZis")},"data-v-ae6cedb6",null);e.default=C.exports}});