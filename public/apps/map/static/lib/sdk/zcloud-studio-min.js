!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.SES=t()}(this,(function(){"use strict";var e={Unknown:"",SingleLayer:"single-layer",GroupLayer:"group-layer"};function t(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function i(e){var t=null;if(e instanceof Array){t=[];for(var n=e.length;n--;)t[n]=i(e[n]);return t}if(e instanceof Object){for(var a in t={},e)t[a]=i(e[a]);return t}return e}var n=["#EB402E","#FCCCDE","#C69EDD","#01C9F2","#47E2DA","#CBBEB4","#F1DA00","#E94096","#039DEB","#FCC9D3","#A4783E","#F1EB32","#F5E708","#FBD43E","#FBDD5C","#FEB801","#FCBD64","#E2A391","#FCC0B0","#FE9892","#FE9499","#FF97AD","#FEB1D6","#E1B7C2","#FC9BCE","#FEC4D0","#BE82AD","#FDAFE6","#E4CEE2","#E3C3E4","#EDCFF5","#D4B5F0","#AD98D9","#CBBDF0","#C9BCED","#CBBFEC","#B5ACD7","#B4ABE4","#9EA6EB","#7387C1","#CDD3EF","#8D94C4","#E4E2EB","#D5D4E1","#9287A3","#A0AFD5","#9BAEE6","#4767C6","#C8DAE9","#C3D6DD","#93B5D1","#356993","#A8D5E2","#C3D6E2","#8AAEE3","#D5E2EC","#E1EAF3","#DFEBF6","#A5D0F9","#A6CBF4","#96BFEF","#B6C5F6","#75CBFB","#72A0D8","#7CC3F4","#A5D7EF","#95D7F3","#73D4FC","#14A3DC","#009FF3","#4BCFF8","#18B2E7","#48D4FC","#01BEF5","#8BBDD2","#8ECAE4"];function a(){var e=n.length,t=Math.floor(Math.random()*e);return n[t]}var r="文本",l="boolean",o="string",s="number";function u(e){return"布尔型"==e?l:"长整数"==e||"整数"==e||"短整数"==e||"浮点数"==e||"双精度"==e?s:o}var y=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},c=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),f=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},v=function(){function i(n){y(this,i),this.options=Object.assign({},{name:"",visible:!0},n),this.se_id=t(),this.type=e.Unknown,this._isSelected=!1}return c(i,[{key:"getID",value:function(){return this.se_id}},{key:"getName",value:function(){return this.options.name}},{key:"setName",value:function(e){this.options.name=e}},{key:"getType",value:function(){return this.type}},{key:"isVisible",value:function(){return this.options.visible}},{key:"setVisible",value:function(e){this.options.visible=e}},{key:"isSelected",value:function(){return this._isSelected}},{key:"setSelected",value:function(e){this._isSelected=e}}]),i}(),p={Unknown:"",Fill:"fill",Line:"line",Symbol:"symbol",Circle:"circle",Heatmap:"heatmap",FillExtrusion:"fill-extrusion",Background:"background"},g={SingleValue:"single-value",ZoomRange:"zoom-range",DataRange:"data-range",DataConditions:"data-conditions",Expression:"expression"},d=function(){function e(t){y(this,e),this.value=t,this.type=g.SingleValue}return c(e,[{key:"toStyleJson",value:function(e,t){var i=this.value;return t&&"line-dasharray"===e&&""===i&&(i=[0,0]),"text-font"===e&&(i=i?[i]:[]),t&&i instanceof Array&&(i=["literal",i]),i&&"text-field"===e&&(i=["get",i]),i}},{key:"toJson",value:function(){return{type:this.type,value:i(this.value)}}},{key:"readJson",value:function(e){this.value=e.value}},{key:"getType",value:function(){return this.type}},{key:"getValue",value:function(){return this.value}},{key:"setValue",value:function(e){this.value=e}}]),e}(),m=function(){function e(t,i){y(this,e),this.type=g.ZoomRange,this.rateType=i||"linear",this.valueList=[],this.initValueList(t)}return c(e,[{key:"toStyleJson",value:function(e){var t=this.valueList.slice(0);if(t.sort((function(e,t){return e.zoom-t.zoom})),"linear"===this.rateType){var i=["interpolate",["linear"],["zoom"]];return t.forEach((function(n,a){var r=Number(n.zoom);if((r||0===r)&&!(a>0&&r===t[a-1].zoom)){i.push(r);var l=n.value.toStyleJson(e,!0);i.push(l)}})),i}if("step"===this.rateType){var n=["step",["zoom"]];return t.forEach((function(i,a){var r=Number(i.zoom);if((r||0===r)&&!(a>0&&r===t[a-1].zoom)){a>0&&n.push(r);var l=i.value.toStyleJson(e,!0);n.push(l)}})),n}return""}},{key:"toJson",value:function(){var e={type:this.type,rateType:this.rateType,valueList:[]};return this.valueList&&this.valueList.length>0&&this.valueList.forEach((function(t){var i={zoom:t.zoom,value:t.value.toJson()};e.valueList.push(i)})),e}},{key:"readJson",value:function(e){var t=this;this.rateType=e.rateType,e.valueList&&e.valueList.length>0&&(this.valueList=[],e.valueList.forEach((function(e){var i=new d;i.readJson(e.value);var n={zoom:e.zoom,value:i};t.valueList.push(n)})))}},{key:"getType",value:function(){return this.type}},{key:"getRateType",value:function(){return this.rateType}},{key:"setRateType",value:function(e){if(this.rateType=e,this.valueList&&0!==this.valueList.length&&"step"===this.rateType&&this.valueList[0].zoom>0){var t=this.valueList[0].value,n={zoom:0,value:new d(i(t.getValue()))};this.valueList.unshift(n)}}},{key:"initValueList",value:function(e){this.valueList=[{zoom:0,value:new d(i(e))},{zoom:22,value:new d(i(e))}]}},{key:"getValueList",value:function(){return this.valueList}},{key:"setValueList",value:function(e){this.valueList=e||[],this.sort()}},{key:"sort",value:function(){this.valueList&&this.valueList.sort((function(e,t){return e.zoom-t.zoom}))}},{key:"addStop",value:function(){if(this.valueList&&!(this.valueList.length<2))for(var e=this.valueList.length,t=0;t<e;t++){var n=this.valueList[t],a=null;if(t<e-1&&(a=this.valueList[t+1]),t===e-1||a.zoom-n.zoom>1){var r={zoom:n.zoom+1,value:new d(i(n.value.getValue()))};return this.valueList.push(r),this.sort(),r}}}},{key:"getValue",value:function(){return this.valueList&&0!==this.valueList.length?this.valueList[0].value.getValue():""}}]),e}(),k=function(){function e(t){y(this,e),t||(t={});var i=t,n=i.rateType,a=i.min,r=i.max,l=i.initValue,o=i.field;this.type=g.DataRange,this.rateType=n||"linear",this.field=o||"",this.min=a||0,this.max=r||0,this.valueList=[],this.initValueList(l,a,r)}return c(e,[{key:"toStyleJson",value:function(e){var t=this.valueList.slice(0);if(this.sort(t),"linear"===this.rateType){var i=["interpolate",["linear"],["get",this.field]],n=null;return t.forEach((function(t){if(!n||n!==t.fieldValue){i.push(t.fieldValue);var a=t.value.toStyleJson(e,!0);i.push(a),n=t.fieldValue}})),i}if("step"===this.rateType){var a=["step",["get",this.field]];return t.forEach((function(t,i){i>0&&a.push(t.fieldValue);var n=t.value.toStyleJson(e,!0);a.push(n)})),a}return""}},{key:"toJson",value:function(){var e={type:this.type,rateType:this.rateType,field:this.field,min:this.min,max:this.max,valueList:[]};return this.valueList&&this.valueList.length>0&&this.valueList.forEach((function(t){var i={fieldValue:t.fieldValue,value:t.value.toJson()};e.valueList.push(i)})),e}},{key:"readJson",value:function(e){var t=this;this.rateType=e.rateType,this.field=e.field,this.min=e.min,this.max=e.max,e.valueList&&e.valueList.length>0&&(this.valueList=[],e.valueList.forEach((function(e){var i=new d;i.readJson(e.value);var n={fieldValue:e.fieldValue,value:i};t.valueList.push(n)})))}},{key:"getType",value:function(){return this.type}},{key:"getRateType",value:function(){return this.rateType}},{key:"setRateType",value:function(e){if(this.rateType=e,this.valueList&&0!==this.valueList.length&&"step"===this.rateType&&this.valueList[0].fieldValue>this.min){var t=this.valueList[0].value,n={fieldValue:this.min,value:new d(i(t.getValue()))};this.valueList.unshift(n)}}},{key:"getField",value:function(){return this.field}},{key:"setField",value:function(e){this.field=e}},{key:"initValueList",value:function(e,t,n){this.valueList=[{fieldValue:t,value:new d(i(e))},{fieldValue:n,value:new d(i(e))}]}},{key:"getValueList",value:function(){return this.valueList}},{key:"setValueList",value:function(e){this.valueList=e,this.sort()}},{key:"sort",value:function(e){e||(e=this.valueList),e&&e.sort((function(e,t){return e.fieldValue-t.fieldValue}))}},{key:"addStop",value:function(){if(this.valueList&&!(this.valueList.length<2)){for(var e=this.valueList.length,t=0,n=0,a=0;a<e-1;a++){var r=this.valueList[a],l=this.valueList[a+1].fieldValue-r.fieldValue;l>n&&(t=a,n=l)}var o=this.valueList[t],s=this.valueList[t+1],u={fieldValue:(o.fieldValue+s.fieldValue)/2,value:new d(i(o.value.getValue()))};return this.valueList.push(u),this.sort(),u}}},{key:"createRangeTheme",value:function(e,t,i){if(!e||e<2)return!1;i=i||"color";for(var n=this.min,a=this.max,r=(a-n)/(e-1),l=[],o=0;o<e;o++){var s=n+r*o;s=Math.min(s,a);var u=null;"color"===i&&(u=new d(t[o])),l.push({fieldValue:s,value:u})}return this.valueList=l,!0}},{key:"getValue",value:function(){return this.valueList&&0!==this.valueList.length?this.valueList[0]:""}}]),e}(),L=function(){function e(){y(this,e),this.type=g.DataConditions,this.fallbackValue="",this.valueList=[]}return c(e,[{key:"toStyleJson",value:function(e){if(!this.valueList||0===this.valueList.length)return"";var t=["case"],i=!1;return this.valueList.forEach((function(n){var a=n.fieldValue;if(""!==a){var r=a.split(",");r&&r.length>0&&u(n.fieldType)==s&&(r=r.map((function(e){return e?Number(e):0})));var l=["match",["get",n.field],r,!0,!1];i=!0,t.push(l),t.push(n.value.toStyleJson(e,!0))}})),t.push(this.fallbackValue.toStyleJson(e,!0)),i?t:this.fallbackValue?this.fallbackValue.toStyleJson(e,!0):""}},{key:"toJson",value:function(){var e={type:this.type,fallbackValue:this.fallbackValue.toJson(),valueList:[]};return this.valueList&&this.valueList.length>0&&this.valueList.forEach((function(t){var i={fieldType:t.fieldType||r,field:t.field,fieldValue:t.fieldValue,value:t.value.toJson()};e.valueList.push(i)})),e}},{key:"readJson",value:function(e){var t=this;e.fallbackValue&&(this.fallbackValue=new d,this.fallbackValue.readJson(e.fallbackValue)),e.valueList&&e.valueList.length>0&&(this.valueList=[],e.valueList.forEach((function(e){var i=new d;i.readJson(e.value);var n={fieldType:e.fieldType||r,field:e.field,fieldValue:e.fieldValue,value:i};t.valueList.push(n)})))}},{key:"useSameField",value:function(){if(!this.valueList||this.valueList.length<2)return!0;for(var e="",t=0;t<this.valueList.length;t++){var i=this.valueList[t];if(e){if(e!==i.field)return!1}else e=i.field}return!0}},{key:"getType",value:function(){return this.type}},{key:"getFallbackValue",value:function(){return this.fallbackValue}},{key:"setFallbackValue",value:function(e){this.fallbackValue=e}},{key:"getValueList",value:function(){return this.valueList}},{key:"setValueList",value:function(e){this.valueList=e}},{key:"getValue",value:function(){return this.fallbackValue}},{key:"addStop",value:function(){if(this.valueList&&this.valueList.length){var e=this.valueList[this.valueList.length-1],t={fieldType:e.fieldType,field:e.field,fieldValue:"",value:new d(i(e.value.getValue()))};return this.valueList.push(t),t}}},{key:"addStops",value:function(e,t){var i=this;if(e&&0!==e.length&&this.valueList&&this.valueList.length){var n=this.valueList[this.valueList.length-1];"color"===(t=t||"color")&&e.forEach((function(e){var t={fieldType:n.fieldType,field:n.field,fieldValue:e,value:new d(a())};i.valueList.push(t)}))}}}]),e}(),S=function(){function e(t,i){y(this,e),this.value=t,this.type=g.Expression,this.fallbackValue=i||null}return c(e,[{key:"toStyleJson",value:function(e){var t=this.value;return t&&t.length>0&&t instanceof Array?t:this.fallbackValue?this.fallbackValue.toStyleJson(e,!1):""}},{key:"toJson",value:function(){return{type:this.type,value:i(this.value),fallbackValue:this.fallbackValue?this.fallbackValue.toJson():null}}},{key:"readJson",value:function(e){e.fallbackValue&&(this.fallbackValue=new d,this.fallbackValue.readJson(e.fallbackValue)),this.value=e.value}},{key:"getType",value:function(){return this.type}},{key:"getValue",value:function(){var e=this.value;return e&&e.length>0&&e instanceof Array?e:""}},{key:"setValue",value:function(e){this.value=e}},{key:"getFallbackValue",value:function(){return this.fallbackValue}},{key:"setFallbackValue",value:function(e){this.fallbackValue=e}}]),e}(),w=function(){function e(i){y(this,e),this.options=Object.assign({},{name:""},i),this.type=p.Unknown,this.se_id=t()}return c(e,[{key:"getType",value:function(){return this.type}},{key:"getName",value:function(){return this.options.name}},{key:"setName",value:function(e){this.options.name=e}},{key:"getPropertyValue",value:function(e){var t=this.options.layout,i=this.options.paint;return t&&t[e]?t[e]:i&&i[e]?i[e]:void 0}},{key:"setPropertyValue",value:function(e,t){var i=this.options.layout,n=this.options.paint;i&&i[e]&&(i[e]=t),n&&n[e]&&(n[e]=t)}},{key:"toStyleJson",value:function(){var e=this.options,t=e.layout,i=e.paint,n={layout:{},paint:{}};if(t)for(var a in t){var r=t[a],l=r.toStyleJson(a);if(r.type!==g.SingleValue&&""===l){var o=this.getDeafultValue(a);o&&(l=o.toStyleJson(a))}n.layout[a]=l}if(i)for(var s in i){var u=i[s],y=u.toStyleJson(s);if(u.type!==g.SingleValue&&""===y){var c=this.getDeafultValue(s);c&&(y=c.toStyleJson(s))}""!==y&&(n.paint[s]=y)}return n}},{key:"toJson",value:function(){var e=this.options,t=e.layout,i=e.paint,n={type:this.type,name:e.name,layout:{},paint:{}};if(t)for(var a in t){var r=t[a];n.layout[a]=r.toJson()}if(i)for(var l in i){var o=i[l];n.paint[l]=o.toJson()}return n}},{key:"readJson",value:function(e){var t=e.layout,i=e.paint,n=(this.options||{}).paint||{},a={name:e.name,layout:{},paint:n};if(t)for(var r in t){var l=t[r],o=this._createStyleValue(l.type);o&&(o.readJson(l),a.layout[r]=o)}if(i)for(var s in i){var u=i[s],y=this._createStyleValue(u.type);y&&(y.readJson(u),a.paint[s]=y)}this.options=a}},{key:"_createStyleValue",value:function(e){var t=null;switch(e){case g.SingleValue:t=new d;break;case g.ZoomRange:t=new m;break;case g.DataRange:t=new k;break;case g.DataConditions:t=new L;break;case g.Expression:t=new S}return t}},{key:"resetValue",value:function(e){var t=this.getDefaultOptions();t.layout&&t.layout[e]&&(this.options.layout[e]=t.layout[e]),t.paint&&t.paint[e]&&(this.options.paint[e]=t.paint[e])}},{key:"getDeafultValue",value:function(e){var t=this.getDefaultOptions();return t.layout&&t.layout[e]?t.layout[e]:t.paint&&t.paint[e]?t.paint[e]:null}}]),e}(),b=function(){return{paint:{"circle-radius":new d(5),"circle-color":new d(a()),"circle-blur":new d(0),"circle-opacity":new d(1),"circle-translate":new d([0,0]),"circle-translate-anchor":new d("map"),"circle-pitch-scale":new d("map"),"circle-pitch-alignment":new d("viewport"),"circle-stroke-width":new d(0),"circle-stroke-color":new d(a()),"circle-stroke-opacity":new d(1),"circle-height":new d(0)}}},x=function(e){function t(e){y(this,t),e=Object.assign({},b(),e);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=p.Circle,i}return f(t,e),c(t,[{key:"getDefaultOptions",value:function(){return b()}}]),t}(w),E=function(){return{layout:{"symbol-placement":new d("point"),"symbol-spacing":new d(250),"symbol-avoid-edges":new d(!1),"symbol-z-order":new d("auto"),"icon-allow-overlap":new d(!1),"icon-ignore-placement":new d(!1),"icon-optional":new d(!1),"icon-rotation-alignment":new d("auto"),"icon-size":new d(1),"icon-text-fit":new d("none"),"icon-text-fit-padding":new d([0,0,0,0]),"icon-image":new d(""),"icon-rotate":new d(0),"icon-padding":new d(0),"icon-keep-upright":new d(!1),"icon-offset":new d([0,0]),"icon-anchor":new d("center"),"icon-pitch-alignment":new d("auto"),"text-pitch-alignment":new d("auto"),"text-rotation-alignment":new d("auto"),"text-field":new d(""),"text-font":new d(""),"text-size":new d(16),"text-max-width":new d(10),"text-line-height":new d(1.2),"text-letter-spacing":new d(0),"text-justify":new d("center"),"text-anchor":new d("center"),"text-max-angle":new d(45),"text-rotate":new d(0),"text-padding":new d(2),"text-keep-upright":new d(!0),"text-transform":new d("none"),"text-offset":new d([0,0]),"text-allow-overlap":new d(!1),"text-ignore-placement":new d(!1),"text-optional":new d(!1)},paint:{"icon-opacity":new d(1),"icon-color":new d("#000000"),"icon-halo-blur":new d(0),"icon-translate":new d([0,0]),"icon-translate-anchor":new d("map"),"text-opacity":new d(1),"text-color":new d("#000000"),"text-halo-color":new d("rgba(0,0,0,0)"),"text-halo-width":new d(0),"text-halo-blur":new d(0),"text-translate":new d([0,0]),"text-translate-anchor":new d("map"),"icon-height":new d(0),"text-height":new d(0)}}},V=function(e){function t(e){y(this,t),e=Object.assign({},E(),e);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=p.Symbol,i}return f(t,e),c(t,[{key:"getDefaultOptions",value:function(){return E()}}]),t}(w),J=function(){return{layout:{"line-cap":new d("butt"),"line-join":new d("miter"),"line-miter-limit":new d(2),"line-round-limit":new d(1.05)},paint:{"line-opacity":new d(1),"line-color":new d(a()),"line-translate":new d([0,0]),"line-translate-anchor":new d("map"),"line-width":new d(1),"line-gap-width":new d(0),"line-offset":new d(0),"line-blur":new d(0),"line-dasharray":new d(""),"line-pattern":new d("")}}},_=function(e){function t(e){y(this,t),e=Object.assign({},J(),e);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=p.Line,i}return f(t,e),c(t,[{key:"getDefaultOptions",value:function(){return J()}}]),t}(w),T=function(){return{paint:{"fill-antialias":new d(!0),"fill-opacity":new d(1),"fill-color":new d(a()),"fill-outline-color":new d("rgba(0,0,0,1)"),"fill-translate":new d([0,0]),"fill-translate-anchor":new d("map"),"fill-pattern":new d("")}}},D=function(e){function t(e){y(this,t),e=Object.assign({},T(),e);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=p.Fill,i}return f(t,e),c(t,[{key:"getDefaultOptions",value:function(){return T()}}]),t}(w),F=function(){return{paint:{"fill-extrusion-opacity":new d(1),"fill-extrusion-color":new d(a()),"fill-extrusion-translate":new d([0,0]),"fill-extrusion-translate-anchor":new d("map"),"fill-extrusion-pattern":new d(""),"fill-extrusion-height":new d(0),"fill-extrusion-base":new d(0),"fill-extrusion-vertical-gradient":new d(!0)}}},O=function(e){function t(e){y(this,t),e=Object.assign({},F(),e);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=p.FillExtrusion,i}return f(t,e),c(t,[{key:"getDefaultOptions",value:function(){return F()}}]),t}(w),C=function(){return{paint:{"background-color":new d(a()),"background-pattern":new d(""),"background-opacity":new d(1)}}},B=function(e){function t(e){y(this,t),e=Object.assign({},C(),e);var i=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.type=p.Background,i}return f(t,e),c(t,[{key:"getDefaultOptions",value:function(){return C()}}]),t}(w),N=function(){function e(t){y(this,e),this.options=Object.assign({},{id:"",name:"",sourceId:"",sourceName:"",fields:null,bounds:null,dtType:"",sourceUrl:""},t)}return c(e,[{key:"toJson",value:function(){var e=this.options;return{name:e.name,id:e.id,sourceId:e.sourceId,sourceName:e.sourceName,fields:e.fields,bounds:e.bounds,dtType:e.dtType,sourceUrl:e.sourceUrl}}},{key:"readJson",value:function(e){var t={name:e.name||"",id:e.id,sourceId:e.sourceId,sourceName:e.sourceName||"",fields:e.fields||null,bounds:e.bounds||null,dtType:e.dtType,sourceUrl:e.sourceUrl||""};this.options=t}},{key:"getID",value:function(){return this.options.id}},{key:"getName",value:function(){return this.options.name}},{key:"setName",value:function(e){this.options.name=e}},{key:"getSourceID",value:function(){return this.options.sourceId}},{key:"getSourceName",value:function(){return this.options.sourceName}},{key:"setSourceName",value:function(e){this.options.sourceName=e}},{key:"getSourceKey",value:function(){return""+this.options.sourceId}},{key:"getFields",value:function(){return this.options.fields}},{key:"setFields",value:function(e){this.options.fields=e}},{key:"getBounds",value:function(){return this.isVaildBounds(this.options.bounds)?this.options.bounds:null}},{key:"setBounds",value:function(e){this.options.bounds=e}},{key:"isVaildBounds",value:function(e){return!(!e||4!==e.length)&&!(e[0]>=e[2]||e[1]>=e[3])}},{key:"getDtType",value:function(){return this.options.dtType}},{key:"getSourceUrl",value:function(){return this.options.sourceUrl}},{key:"setSourceUrl",value:function(e){this.options.sourceUrl=e}},{key:"getSourceJson",value:function(){var e=this.options;return{name:e.sourceName,id:e.sourceId,url:e.sourceUrl}}}]),e}(),z=function(){function e(t){y(this,e),this.options=Object.assign({},{field:"",opt:"==",value:"",fieldType:r},t)}return c(e,[{key:"toStyleJson",value:function(){var e=this.options;if(""===e.field||void 0===e.field)return"";if("has"===e.opt||"!has"===e.opt)return[e.opt,e.field];if(""===e.value)return"";var t=null;return e.value&&(t="in"===e.opt||"!in"===e.opt?(t=e.value.split(",")).filter((function(e){return e&&e.trim()})):[e.value.trim()]),t&&0!==t.length?(u(e.fieldType)==s&&(t=t.map((function(e){return Number(e)}))),[e.opt,e.field].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(t))):""}},{key:"toJson",value:function(){var e=this.options;return{field:e.field,opt:e.opt,value:e.value,fieldType:e.fieldType}}},{key:"readJson",value:function(e){var t={field:e.field,opt:e.opt,value:e.value,fieldType:e.fieldType};this.options=t}}]),e}(),A=function(t){function n(t){y(this,n),t=Object.assign({},{sourceLayer:null,minZoom:0,maxZoom:22,filters:null,filterOperation:"all",layerStyle:null,layerStyleType:p.Unknown,multiLayerStyles:[],isMultiStyle:!1},t);var i=h(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return i.type=e.SingleLayer,i._initLayerStyle(),i._group="",i}return f(n,t),c(n,[{key:"toThemeJson",value:function(){var e=this.options;if(e.layerStyle){var t={id:this.getName(),type:this.getLayerStyleType(),minzoom:e.minZoom,maxzoom:e.maxZoom,filter:null};if(e.filters&&e.filters.length>0){var i=[e.filterOperation];e.filters.forEach((function(e){var t=e.toStyleJson();t&&i.push(t)})),1===i.length?delete t.filter:t.filter=i}else delete t.filter;var n=e.layerStyle.toStyleJson();return n.layout&&(t.layout=n.layout),n.paint&&(t.paint=n.paint),t}}},{key:"toStyleJson",value:function(e){var t=this.options,i=t.visible?"visible":"none";if(t.layerStyle){var n={id:this.getName(),minzoom:t.minZoom,maxzoom:t.maxZoom,filter:null};if(t.sourceLayer&&(n.source=t.sourceLayer.getSourceKey(),n["source-layer"]=t.sourceLayer.getName()),t.filters&&t.filters.length>0){var a=[t.filterOperation];t.filters.forEach((function(e){var t=e.toStyleJson();t&&a.push(t)})),n.filter=a}else delete n.filter;for(var r=[],l=(r=t.isMultiStyle&&t.multiLayerStyles&&t.multiLayerStyles.length>0?t.multiLayerStyles:[t.layerStyle]).length-1;l>=0;l--){var o=r[l],s=Object.assign({},n);s.type=o.getType(),this.group&&(s.metadata={group:this.group});var u=o.toStyleJson();u.layout?(s.layout=u.layout,s.layout.visibility=i):(s.layout=s.layout||{},s.layout.visibility=i),u.paint&&(s.paint=u.paint),e.push(s)}}}},{key:"toJson",value:function(){var e=this.options,t={name:this.getName(),type:this.getType(),visible:this.isVisible(),minZoom:e.minZoom,maxZoom:e.maxZoom,filterOperation:e.filterOperation,layerStyleType:e.layerStyleType,sourceLayer:null,filters:null,layerStyle:null,multiLayerStyles:null,isMultiStyle:e.isMultiStyle};if(e.sourceLayer&&(t.sourceLayer=e.sourceLayer.toJson()),e.filters&&e.filters.length>0){var i=[];e.filters.forEach((function(e){var t=e.toJson();t&&i.push(t)})),t.filters=i}if(e.layerStyle){var n=e.layerStyle.toJson();n&&(t.layerStyle=n)}return e.isMultiStyle&&e.multiLayerStyles&&e.multiLayerStyles.length&&(t.multiLayerStyles=[],e.multiLayerStyles.forEach((function(e){var i=e.toJson();i&&t.multiLayerStyles.push(i)}))),t}},{key:"readJson",value:function(e){var t=this,i={name:e.name,visible:e.visible,minZoom:e.minZoom,maxZoom:e.maxZoom,filterOperation:e.filterOperation,layerStyleType:e.layerStyleType,sourceLayer:null,filters:[],layerStyle:null,multiLayerStyles:null,isMultiStyle:e.isMultiStyle};if(e.sourceLayer){var n=new N;n.readJson(e.sourceLayer),i.sourceLayer=n}if(e.filters&&e.filters.length>0&&e.filters.forEach((function(e){var t=new z;t.readJson(e),i.filters.push(t)})),e.layerStyle){var a=e.layerStyle.type,r=this._createLayerStyle(a);r.readJson(e.layerStyle),i.layerStyle=r}e.isMultiStyle&&e.multiLayerStyles&&e.multiLayerStyles.length>0&&(i.multiLayerStyles=[],e.multiLayerStyles.forEach((function(e){var n=e.type,a=t._createLayerStyle(n);a.readJson(e),i.multiLayerStyles.push(a)}))),this.options=i}},{key:"getSourceLayer",value:function(){return this.options.sourceLayer}},{key:"setSourceLayer",value:function(e){this.options.sourceLayer=e}},{key:"getMinZoom",value:function(){return this.options.minZoom}},{key:"setMinZoom",value:function(e){this.options.minZoom=e}},{key:"getMaxZoom",value:function(){return this.options.maxZoom}},{key:"setMaxZoom",value:function(e){this.options.maxZoom=e}},{key:"getFilterOperation",value:function(){return this.options.filterOperation}},{key:"setFilterOperation",value:function(e){this.options.filterOperation=e}},{key:"getFilters",value:function(){return this.options.filters}},{key:"setFilters",value:function(e){this.options.filters=e}},{key:"addFilter",value:function(e){this.options.filters||(this.options.filters=[]),this.options.filters.push(e)}},{key:"removeFilter",value:function(e){!this.options.filters||this.options.filters.length<=e||this.options.filters.splice(e,1)}},{key:"getLayerStyle",value:function(){return this.options.layerStyle}},{key:"setLayerStyle",value:function(){return this.options.layerStyle}},{key:"getLayerStyleType",value:function(){return this.options.layerStyleType}},{key:"setLayerStyleType",value:function(e){this.options.layerStyleType!==e&&(this.options.layerStyleType=e,this._initLayerStyle())}},{key:"_initLayerStyle",value:function(){var e=this.options.layerStyleType,t=this._createLayerStyle(e);this.options.layerStyle=t,this.options.isMultiStyle=!1,this.options.multiLayerStyles=null}},{key:"_createLayerStyle",value:function(e){var t=null;switch(e){case p.Circle:t=new x;break;case p.Symbol:t=new V;break;case p.Line:t=new _;break;case p.Fill:t=new D;break;case p.FillExtrusion:t=new O;break;case p.Background:t=new B}return t}},{key:"createLayerStyle",value:function(e,t){var i=this._createLayerStyle(t);return i.setName(e),i}},{key:"getBounds",value:function(){return this.options.sourceLayer?this.options.sourceLayer.getBounds():null}},{key:"isMultiStyle",value:function(){return this.options.isMultiStyle}},{key:"setIsMultiStyle",value:function(e){this.options.isMultiStyle=e}},{key:"getMultiLayerStyles",value:function(){return this.options.multiLayerStyles}},{key:"addMultiLayerStyle",value:function(e){this.options.multiLayerStyles||(this.options.multiLayerStyles=[]),this.options.multiLayerStyles.push(e)}},{key:"clone",value:function(){var e=this.toJson(),t=new n;if(t.readJson(e),t.group=this.group,this.options.sourceLayer){var a=new N(i(this.options.sourceLayer.options));t.setSourceLayer(a)}return t}},{key:"group",set:function(e){this._group=e},get:function(){return this._group}}]),n}(v),j=function(t){function i(t){y(this,i),t=Object.assign({},{layers:null,isExpanded:!1},t);var n=h(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return n.type=e.GroupLayer,n}return f(i,t),c(i,[{key:"toStyleJson",value:function(e){if(this.options.visible){var t=this.options.layers;if(t&&0!==t.length)for(var i=t.length-1;i>=0;i--){t[i].toStyleJson(e)}}}},{key:"toJson",value:function(){var e={name:this.getName(),type:this.getType(),visible:this.isVisible(),isExpanded:this.isExpanded(),layers:[]};return this.options.layers&&this.options.layers.length>0&&this.options.layers.forEach((function(t){e.layers.push(t.toJson())})),e}},{key:"readJson",value:function(t){var n={name:t.name,visible:t.visible,isExpanded:t.isExpanded,layers:[]};t.layers&&t.layers.length>0&&t.layers.forEach((function(a){var r=a.type,l=null;r===e.SingleLayer?l=new A:r===e.GroupLayer&&(l=new i),l&&(l.readJson(a),l instanceof i&&(l.group=t.name),n.layers.push(l))})),this.options=n}},{key:"getLayers",value:function(){return this.options.layers}},{key:"setLayers",value:function(e){this.options.layers=e}},{key:"isExpanded",value:function(){return this.options.isExpanded}},{key:"setExpanded",value:function(e){this.options.isExpanded=e}},{key:"addLayer",value:function(e){this.options.layers||(this.options.layers=[]),this.options.layers.push(e)}},{key:"clone",value:function(){var e=this,t=new i,n=this.options.layers;return n&&n.length>0&&n.forEach((function(i){var n=i.clone();n.group=e.getName(),t.addLayer(n)})),t}}]),i}(v),I=function(){function e(t){y(this,e);var i=t=t||{},n=i.name,a=void 0===n?"":n,r=i.collapsed,l=void 0!==r&&r;this._name=a,this._collapsed=l}return c(e,[{key:"readJson",value:function(e){e=e||{},this._name=e.name||"",this._collapsed=e.collapsed||!1}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"collapsed",set:function(e){this._collapsed=e},get:function(){return this._collapsed}}]),e}();!function(){function e(t){y(this,e);var i=(t=t||{}).groups,n=void 0===i?{}:i;this._groups=n}c(e,[{key:"readJson",value:function(e){var t=(e||{}).groups,i=void 0===t?null:t;if(i)for(var n in this._groups={},i){var a=new I;a.readJson(i[n]),this._groups[n]=a}}},{key:"groups",set:function(e){this._groups=e},get:function(){return this._groups}}])}();return{SeStyle:function(){function t(e){y(this,t),this.options=Object.assign({},{name:"新地图",crsId:3857,center:[0,0],zoom:3,bearing:0,pitch:0,sprite:"",glyphs:"",layers:null,useFont:!1},e),this.id="",this.serviceUrl=""}return c(t,[{key:"replaceUrl",value:function(e){return this.serviceUrl?(-1!==e.indexOf(this.serviceUrl)&&(e=e.replace(this.serviceUrl,"luokung:/")),e):e}},{key:"toThemeJson",value:function(){var e=this.options,t={name:e.name,sprite:e.sprite,glyphs:e.glyphs,layers:[]};if(e.layers&&e.layers.length>0)for(var i=this.options.layers,n=i.length-1;n>=0;n--){var a=i[n].toThemeJson();a&&t.layers.push(a)}return t}},{key:"getGroups",value:function(){var e=this.options.layers,t={};if(e)for(var i=e.length-1;i>=0;i--){var n=e[i];n instanceof j&&(t[n.getName()]={name:n.getName(),collapsed:!n.isExpanded()})}return t}},{key:"toStyleJson",value:function(){var e=this.options,t={version:8,name:e.name,center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch,sprite:e.sprite,glyphs:e.glyphs,metadata:{useFont:e.useFont,groups:this.getGroups()},sources:{},layers:[]},i=this.getSources();if(i)for(var n in i){var a=i[n];t.sources[n]={type:"vector",url:a.url}}if(e.layers&&e.layers.length>0)for(var r=this.options.layers,l=r.length-1;l>=0;l--){r[l].toStyleJson(t.layers)}if(this.serviceUrl)for(var o in t.glyphs=t.glyphs,t.sprite=t.sprite,t.sources){var s=t.sources[o];s.url=s.url}return t}},{key:"toJson",value:function(){var e=this.options,t={name:e.name,center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch,sprite:e.sprite,glyphs:e.glyphs,useFont:e.useFont,sources:this.getSources()||{},layers:[]},i=this.options.layers;if(i&&i.length>0&&i.forEach((function(e){t.layers.push(e.toJson())})),this.serviceUrl)for(var n in t.glyphs=t.glyphs,t.sprite=t.sprite,t.sources){var a=t.sources[n];a.url=a.url}return t}},{key:"readJson",value:function(t){var i={id:t.id,name:t.name,center:t.center||[0,0],zoom:void 0!==t.zoom?t.zoom:3,bearing:t.bearing||0,pitch:t.pitch||0,sprite:t.sprite,glyphs:t.glyphs,layers:[],metadata:{},sources:{}};t.layers&&t.layers.length>0&&t.layers.forEach((function(t){var n=t.type,a=null;n===e.SingleLayer?a=new A:n===e.GroupLayer&&(a=new j),a&&(a.readJson(t),i.layers.push(a))})),t.metadata,this.options=Object.assign({},this.options,i);var n=this.getLayers(!0),a=t.sources;a&&Object.keys(a).length>0&&n&&n.length>0&&n.forEach((function(e){var t=e.getSourceLayer();if(t&&!t.getSourceUrl()){var i=t.getSourceKey();a[i]&&t.setSourceUrl(a[i].url)}}))}},{key:"getID",value:function(){return this.id}},{key:"setID",value:function(e){this.id=e}},{key:"getName",value:function(){return this.options.name}},{key:"setName",value:function(e){this.options.name=e}},{key:"getCrsId",value:function(){return this.options.crsId}},{key:"setCrsId",value:function(e){this.options.crsId=e}},{key:"setCenter",value:function(e){this.options.center=e}},{key:"setZoom",value:function(e){this.options.zoom=e}},{key:"setBearing",value:function(e){this.options.bearing=e}},{key:"setPitch",value:function(e){this.options.pitch=e}},{key:"setSprite",value:function(e){this.options.sprite=e}},{key:"getSpriteId",value:function(){return this.options.spriteId}},{key:"setSpriteId",value:function(e){this.options.spriteId=e}},{key:"setGlyphs",value:function(e){this.options.glyphs=e}},{key:"getLayers",value:function(e){var t=this.options.layers;if(!t||0===t.length)return null;if(!e)return t;var i=[];return this._forEachLayers(t,i),i}},{key:"setLayers",value:function(e){this.options.layers=e}},{key:"_forEachLayers",value:function(t,i){var n=this;t&&0!==t.length&&t.forEach((function(t){t.getType()===e.GroupLayer?n._forEachLayers(t.getLayers(),i):i.push(t)}))}},{key:"addLayer",value:function(e,t){this.options.layers||(this.options.layers=[]),t?this.options.layers.unshift(e):this.options.layers.push(e)}},{key:"getLayer",value:function(e){var t=this.getLayers();return t&&0!==t.length?this._getLayer(t,e):null}},{key:"_getLayer",value:function(t,i){if(!t||0===t.length)return null;for(var n=0;n<t.length;n++){var a=t[n];if(a.getID()===i)return a;if(a.getType()===e.GroupLayer){var r=a.getLayers(),l=this._getLayer(r,i);if(l)return l}}return null}},{key:"getSelectedLayer",value:function(){var t=function t(i){if(!i||0===i.length)return null;for(var n=0;n<i.length;n++){var a=i[n];if(a.isSelected())return a;if(a.getType()===e.GroupLayer){var r=t(a.getLayers());if(r)return r}}return null};return t(this.getLayers())}},{key:"setSelectedLayer",value:function(e){var t=this.getSelectedLayer();t&&t.setSelected(!1);var i=this.getLayer(e);i&&i.setSelected(!0)}},{key:"hasLayer",value:function(t,i){if(void 0===i&&(i=this.getLayers()),!i||0===i.length)return!1;for(var n=0;n<i.length;n++){var a=i[n];if(a.getName()===t)return!0;if(a.getType()===e.GroupLayer)if(this.hasLayer(t,a.getLayers()))return!0}return!1}},{key:"removeLayer",value:function(e){var t=this.getLayers();t&&0!==t.length&&(this._removeLayer(t,e),this.options.layers=t)}},{key:"copyLayer",value:function(t){var i=this,n=this.getLayer(t);if(!n)return null;var a=n.clone();(a.setName(this.createLayerName(""+n.getName())),a.getType()===e.GroupLayer)&&a.getLayers().forEach((function(e){e.setName(i.createLayerName(e.getName())),e.group=a.name}));var r=this.getLayers();return r.forEach((function(i,n){if(i.getID()!==t){if(i.getType()===e.GroupLayer){var l=i.getLayers();if(!l||0===l.length)return;l.forEach((function(e,i){e.getID()!==t||l.splice(i+1,0,a)}))}}else r.splice(n+1,0,a)})),a}},{key:"_removeLayer",value:function(t,i){if(t&&0!==t.length)for(var n=0;n<t.length;n++){var a=t[n];if(a.getID()===i)return void t.splice(n,1);a.getType()===e.GroupLayer&&this._removeLayer(a.getLayers(),i)}}},{key:"getSources",value:function(){var e=this.getSourceLayers();if(!e||0===e.length)return null;var t={};return e.forEach((function(e){var i=e.getSourceKey();t[i]||(t[i]=e.getSourceJson())})),t}},{key:"getSourceLayers",value:function(e){var t=this.getLayers(!0);if(!t||0===t.length)return null;var i=[];return t.forEach((function(t){var n=t.getSourceLayer();n&&(e&&n.getSourceID()!==e||i.push(n))})),i}},{key:"createLayerName",value:function(e){if(!this.hasLayer(e))return e;for(var t="",i=1;t=e+"_"+i,i++,this.hasLayer(t););return t}},{key:"updateSourceInfo",value:function(e){if(e&&e.vector_layers&&e.vector_layers.length){var t=this.getSourceLayers(e.data_id);if(t&&0!==t.length)e.vector_layers.forEach((function(e){t.forEach((function(t){t.getID()===e.data_id&&(t.setBounds(e.bounds),t.setSourceName(e.source_name),t.setName(e.name),t.setFields(e.field_list))}))}))}}}]),t}(),SingleLayer:A,GroupLayer:j,LayerType:e,LayerStyleType:p,StyleValueType:g,SourceLayer:N,Filter:z,SingleValue:d,DataConditionsValue:L,DataRangeValue:k,ZoomRangeValue:m,ExpressionValue:S,clone:i}}));
